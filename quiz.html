<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadytoFly - Join the Waitlist</title>
    
    <!-- 
    ============================================
    READYTOFLY WAITLIST QUIZ - REFACTORED VERSION
    ============================================
    
    What changed:
    • Reorganized CSS into logical groups (Base, Layout, Components, Utilities, Mobile)
    • Consolidated JS into modules (Config, State, Helpers, Renderers, Handlers, Core)
    • Removed duplicate code and unused styles
    • Added clear section markers for easier navigation
    • Preserved ALL functionality, animations, and visual design
    
    How to edit:
    • Palette tokens: See :root variables in CSS
    • Component styles: Find in COMPONENTS section
    • Screen renderers: Located in RENDERERS module
    • Quiz logic: See CORE QUIZ LOGIC section
    
    No visual or behavioral changes - pure code organization refactor
    -->
    
    <style>
        /* ============================================
           BASE: TOKENS & RESET
           ============================================ */
        :root {
            /* Color palette */
            --peach: #FFD6B0;
            --coral: #FF7B73;
            --lavender: #C8B6FF;
            --sky: #A7D8FF;
            --sky-100: #E6F3FF;
            --white: #FFFFFF;
            --ink: #1F2A44;
            --muted: #6B7280;
            
            /* CTA gradients */
            --cta-grad: linear-gradient(90deg, var(--coral), var(--lavender));
            --cta-grad-hover: linear-gradient(90deg, #FF8C82, #BFA6FF);
            
            /* Surfaces & lines */
            --surface: #FFFFFF;
            --surface-alt: #F9FBFF;
            --border: #E6EEF7;
            --shadow: 0 8px 30px rgba(31,42,68,.08);
            
            /* Focus ring */
            --ring: var(--sky);
            
            /* Status colors (for gauges) */
            --status-low: var(--coral);
            --status-medium: var(--peach);
            --status-high: var(--lavender);
            --status-excellent: var(--sky);
            
            /* Spacing system */
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border radius */
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 300ms ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            /* Fallback gradient for when image doesn't load */
            background: linear-gradient(135deg, 
                rgba(255, 123, 115, 0.4) 0%,
                rgba(255, 214, 176, 0.4) 20%,
                rgba(200, 182, 255, 0.4) 40%,
                rgba(167, 216, 255, 0.4) 60%,
                rgba(255, 214, 176, 0.3) 80%,
                rgba(255, 182, 193, 0.3) 100%
            );
            background-image: url('images/quiz-background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            min-height: 100vh;
            color: var(--ink);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* ============================================
           LAYOUT
           ============================================ */
        .quiz-container {
            max-width: 700px;
            margin: 0 auto;
            padding: var(--space-xl);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .quiz-header {
            text-align: center;
            padding: var(--space-xl) 0;
            margin-bottom: var(--space-md);
            background: transparent;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: var(--radius-xl);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 200px;
            margin: 0 auto;
        }

        .logo svg {
            width: 100%;
            height: auto;
        }
        
        .logo svg path,
        .logo svg rect {
            fill: var(--white);
        }

        .question-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.98);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border);
            animation: fadeIn var(--transition-base);
            backdrop-filter: blur(20px);
        }

        /* ============================================
           COMPONENTS: Typography
           ============================================ */
        h2 {
            font-size: 2rem;
            margin-bottom: var(--space-xl);
            line-height: 1.3;
            color: var(--ink);
            font-weight: bold;
        }

        h3 {
            font-size: 1.125rem;
            margin-bottom: var(--space-lg);
            color: var(--muted);
            font-weight: normal;
            line-height: 1.5;
        }

        .step-prefix {
            font-size: 0.875rem;
            color: var(--muted);
            text-transform: uppercase;
            display: block;
            margin-bottom: 0.5rem;
        }

        /* ============================================
           COMPONENTS: Progress Bar
           ============================================ */
        .progress-section {
            margin-bottom: var(--space-md);
            margin-top: auto;
        }

        .section-label {
            font-size: 0.875rem;
            color: var(--white);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--space-sm);
            font-weight: 500;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: var(--white);
            border-radius: var(--radius-md);
            transition: width var(--transition-base);
        }

        /* ============================================
           COMPONENTS: Buttons
           ============================================ */
        .btn {
            padding: var(--space-md) var(--space-2xl);
            border-radius: var(--radius-lg);
            font-size: 1.125rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--cta-grad);
            color: var(--white);
            flex: 1;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--cta-grad-hover);
            transform: translateY(-2px);
        }

        .btn-primary:focus-visible {
            outline: 2px solid var(--ring);
            outline-offset: 2px;
        }

        .btn:disabled {
            opacity: 0.55;
            cursor: not-allowed;
            transform: none;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--muted);
            font-size: 1rem;
            cursor: pointer;
            margin-bottom: var(--space-xl);
            transition: color var(--transition-fast);
            font-weight: 500;
            background: none;
            border: none;
        }

        .back-button:hover {
            color: var(--sky);
        }

        .back-button svg {
            width: 20px;
            height: 20px;
        }

        .navigation-buttons {
            display: flex;
            gap: var(--space-md);
            margin-top: auto;
            padding-top: var(--space-xl);
        }

        /* ============================================
           COMPONENTS: Options
           ============================================ */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .option-button {
            background: var(--white);
            border: 2px solid var(--border);
            color: var(--ink);
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
            font-weight: 500;
        }

        .option-button:hover {
            background: #D9EDFF;
            border-color: var(--sky);
            transform: translateX(4px);
        }

        .option-button.selected {
            background: var(--sky-100);
            border-color: var(--sky);
            color: var(--ink);
            font-weight: 600;
        }

        .checkbox-option {
            padding-left: 4rem;
            position: relative;
        }

        .checkbox-option::before {
            content: '';
            position: absolute;
            left: var(--space-lg);
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: 4px;
            background: var(--white);
            transition: all var(--transition-fast);
        }

        .checkbox-option.selected::before {
            background: var(--sky);
            border-color: var(--sky);
            content: '✔';
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
        }

        /* ============================================
           COMPONENTS: Input Fields
           ============================================ */
        .input-field {
            background: var(--white);
            border: 2px solid var(--border);
            color: var(--ink);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            width: 100%;
            margin-bottom: var(--space-md);
            transition: all var(--transition-fast);
        }

        .input-field:focus {
            outline: 2px solid var(--ring);
            outline-offset: 2px;
            border-color: var(--sky);
        }

        /* ============================================
           COMPONENTS: Gauge
           ============================================ */
        .gauge-container {
            position: relative;
            width: 280px;
            height: 200px;
            margin: var(--space-2xl) auto;
        }

        .gauge-svg {
            width: 100%;
            height: 100%;
        }

        .gauge-background {
            fill: none;
            stroke: #E8EEF7;
            stroke-width: 20;
        }

        .gauge-fill {
            fill: none;
            stroke-width: 20;
            stroke-linecap: round;
            transition: all 0.8s ease;
        }

        .gauge-fill.low { stroke: var(--status-low); }
        .gauge-fill.medium { stroke: var(--status-medium); }
        .gauge-fill.high { stroke: var(--status-high); }
        .gauge-fill.excellent { stroke: var(--status-excellent); }

        .score-display {
            position: absolute;
            top: 70%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--ink);
        }

        .score-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ============================================
           COMPONENTS: Info Screens
           ============================================ */
        .info-screen {
            text-align: center;
            padding: var(--space-xl) var(--space-lg);
        }

        .info-screen h2 {
            margin-bottom: var(--space-xl);
        }

        .info-card {
            background: var(--surface-alt);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            margin: var(--space-xl) 0;
            border: 1px solid var(--border);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--sky);
            margin-bottom: var(--space-sm);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-xl);
            background: var(--sky-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: var(--sky);
        }

        .waitlist-badge {
            display: inline-block;
            background: var(--cta-grad);
            color: var(--white);
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-lg);
            font-weight: 600;
            margin: var(--space-md) 0;
        }

        .calculating-screen {
            text-align: center;
            padding: var(--space-2xl) var(--space-xl);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .simple-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #E6EEF7;
            border-top: 3px solid var(--sky);
            border-radius: 50%;
            animation: simpleRotate 1s linear infinite;
            margin: 0 auto;
        }
        
        .calculating-text {
            font-size: 1.125rem;
            color: var(--ink);
            font-weight: 500;
            margin: var(--space-lg) 0;
        }
        
        .calculating-subtext {
            font-size: 0.875rem;
            color: var(--muted);
            margin-top: var(--space-md);
        }
        
        .dot-animation {
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        /* ============================================
           ANIMATIONS
           ============================================ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes simpleRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ============================================
           UTILITIES
           ============================================ */
        .hidden {
            display: none !important;
        }

        /* ============================================
           MOBILE RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            body {
                background-size: cover;
                background-position: center;
            }
            
            .quiz-container { 
                padding: var(--space-sm); 
                min-height: 100dvh;
            }
            
            .quiz-header {
                padding: var(--space-md);
                margin-bottom: var(--space-md);
            }
            
            .logo {
                width: 150px;
            }
            
            .progress-section {
                margin-bottom: var(--space-lg);
            }
            
            h2 { 
                font-size: 1.5rem; 
                margin-bottom: var(--space-md);
            }
            
            .step-prefix {
                font-size: 0.625rem;
            }
            
            h3 {
                font-size: 1rem;
                margin-bottom: var(--space-md);
            }
            
            .question-container { 
                padding: var(--space-md);
                margin-bottom: var(--space-md);
            }
            
            .info-screen {
                padding: var(--space-md);
            }
            
            .info-card {
                padding: var(--space-lg);
                margin: var(--space-md) 0;
            }
            
            .gauge-container { 
                width: 220px; 
                height: 160px;
                margin: var(--space-lg) auto;
            }
            
            .score-number { 
                font-size: 2rem; 
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .options-container {
                gap: var(--space-sm);
                margin-bottom: var(--space-md);
            }
            
            .option-button {
                padding: var(--space-md) var(--space-lg);
                font-size: 0.875rem;
            }
            
            .checkbox-option {
                padding-left: 3rem;
            }
            
            .checkbox-option::before {
                width: 20px;
                height: 20px;
                left: var(--space-md);
                font-size: 0.875rem;
            }
            
            .navigation-buttons {
                padding-top: var(--space-md);
            }
            
            .btn {
                padding: var(--space-sm) var(--space-lg);
                font-size: 1rem;
            }
            
            .back-button {
                margin-bottom: var(--space-md);
                font-size: 0.875rem;
            }
            
            .section-label {
                display: none;
            }
            
            .progress-bar {
                height: 6px;
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="quiz-header">
            <div class="logo">
                <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 587.15 157.75">
                    <g id="Layer_1-2" data-name="Layer 1">
                        <path d="M587.15,25.07c0,.07,0,.15,0,.21,0,.06,0,.12-.01.18,0,.09-.02.17-.04.26-.02.09-.05.18-.08.26-.03.09-.07.19-.11.28-.06.13-.14.26-.23.37-.06.08-.13.16-.21.23-.02.02-.03.03-.05.05-.07.06-.14.11-.21.17-.03.03-.06.05-.09.06-.07.05-.15.09-.24.13-.11.05-.21.09-.33.13-.1.03-.21.06-.33.07-.03,0-.05.01-.07,0-.1.02-.22.03-.33.03-.38,0-.78-.08-1.17-.25-2.64-1.15-7.9-2.86-13.53-1.43-.23.06-.46.12-.68.19-.19.05-.37.11-.55.17-6.43,2.17-9.35,7.64-10.52,10.75-.12.32-.3.61-.55.82-.71.58-1.74.75-2.76.38,0,0,0,0-.01,0h0c-.82-.3-1.49-.88-1.91-1.59-.3-.51-.37-1.09-.29-1.62.66-4.23.73-10.81-2.59-18.07l-.29-.62c-.4-.83-.84-1.65-1.3-2.45-.21-.36-.43-.72-.66-1.07-.25-.4-.51-.79-.78-1.18-.17-.26-.35-.5-.53-.75-.52-.72-1.08-1.43-1.66-2.12-.13-.15-.26-.31-.39-.46-.3-.34-.59-.67-.9-1-.21-.23-.43-.45-.65-.67-.06-.06-.12-.12-.18-.18-.34-.34-.68-.69-1.04-1.01-.24-.22-.48-.44-.72-.65-.03-.03-.07-.06-.1-.09-.95-.84-1.3-2.08-.94-3.08.02-.07.05-.14.08-.21.04-.07.08-.15.12-.23.03-.05.07-.11.11-.16.03-.04.06-.07.09-.11t0-.01s.03-.03.04-.04c.02-.01.03-.03.05-.05.06-.07.13-.13.2-.18.05-.05.11-.09.17-.13.02-.02.06-.03.08-.05.06-.03.13-.07.2-.1.07-.04.16-.07.25-.1.06-.03.13-.05.21-.06.84-.19,1.83.05,2.6.73,4.43,3.89,8.06,8.63,10.5,13.71,2.03,4.2,3.07,8.21,3.53,11.8,2.32-2.43,5.48-4.61,9.76-5.7,2.94-.75,5.78-.83,8.35-.56.57.05,1.13.13,1.66.22.81.13,1.58.3,2.31.48.24.06.48.12.71.19.47.13.92.26,1.34.4.21.07.42.13.61.21.75.26,1.42.52,2,.77.06.03.14.06.2.09,1.1.51,1.81,1.59,1.86,2.66Z"/>
                        <path d="M5.45,149.02h5.35c2.93,0,5.18,2.36,4.76,4.99h0c-.35,2.15-2.37,3.74-4.76,3.74h-5.35c-2.93,0-5.18-2.36-4.76-4.99h0c.35-2.15,2.37-3.74,4.76-3.74Z"/>
                        <rect x="23.42" y="149.02" width="20.52" height="8.72" rx="4.36" ry="4.36"/>
                        <rect x="52.32" y="149.02" width="27.05" height="8.72" rx="4.36" ry="4.36"/>
                        <rect x="87.57" y="149.02" width="29.23" height="8.72" rx="4.36" ry="4.36"/>
                        <g>
                            <g>
                                <path d="M28.81,56.21c1.47,0,2.7.5,3.71,1.49,1,1,1.5,2.22,1.5,3.67,0,1.45-.51,2.68-1.51,3.67-1.01,1-2.24,1.49-3.71,1.49h-9.51c-2.47,0-4.56.82-6.26,2.47-1.7,1.65-2.55,3.69-2.56,6.14l-.04,35.67c0,1.45-.51,2.68-1.51,3.67-1.01.99-2.24,1.49-3.71,1.49s-2.7-.5-3.71-1.49C.5,113.48,0,112.26,0,110.81l.04-35.67c0-2.68.51-5.16,1.52-7.46,1.01-2.29,2.38-4.3,4.12-6.02,1.74-1.72,3.79-3.06,6.15-4.01,2.36-.96,4.85-1.43,7.48-1.43h9.51Z"/>
                                <path d="M95.46,89.37l-44.59.13c1.51,9.5,8.85,16.09,19.11,17.23,5.83.63,13.3.25,20.53-6.08,2.28-.89,4.94-.63,5.95,1.65,1.14,2.15,0,4.69-2.29,5.95-5.83,5.83-14.58,8.61-25.47,7.47-16.34-1.52-27.6-14.31-27.58-29.89.02-16.47,13.33-29.77,29.93-29.77s29.12,12.67,29.1,28.63c0,2.28-1.78,4.18-3.93,4.56-.25.13-.51.13-.76.13ZM50.87,82.4h39.65c-1-10.01-9.1-17.61-19.49-17.61s-18.63,7.09-20.16,17.61Z"/>
                                <path d="M167.53,86.83q0,.13,0,.25l-.03,24.45c0,2.53-2.03,4.56-4.44,4.56-2.53,0-4.43-2.03-4.43-4.56v-5.57c-5.32,5.95-12.67,10.39-21.29,10.39-16.59,0-30.01-13.43-29.99-30.02.02-16.59,13.46-30.15,30.06-30.15s30.13,13.55,30.11,30.15v.51ZM158.04,86.33c.01-11.4-9.22-20.65-20.62-20.65s-20.53,9.25-20.54,20.65c-.01,11.27,9.22,20.52,20.5,20.52s20.66-9.25,20.67-20.52Z"/>
                                <path d="M235.18,85.57v.25c0,.13,0,.38,0,.51-.02,16.47-13.59,30.02-30.18,30.02s-30.01-13.55-29.99-30.02c.02-16.72,13.46-30.15,30.06-30.15,8.23,0,15.83,3.29,21.27,8.74l.04-32.93c0-2.66,1.91-4.69,4.44-4.69s4.43,2.03,4.43,4.69l-.06,53.58ZM225.68,86.33c.01-11.27-9.22-20.52-20.62-20.52s-20.53,9.25-20.54,20.52c-.01,11.4,9.22,20.52,20.5,20.52s20.66-9.12,20.67-20.52Z"/>
                                <path d="M298.92,63.15l-34.42,75.35c-.89,1.77-2.54,2.91-4.31,2.91-.89,0-1.52-.13-2.15-.38-2.4-1.14-3.42-4.18-2.4-6.46l11.3-22.65-21.98-48.64c-1.14-2.53-.12-5.45,2.16-6.59,2.54-1.14,5.32-.13,6.46,2.28l18.57,41.04,18.03-40.91c1.14-2.41,3.93-3.55,6.46-2.41,2.28,1.01,3.42,3.93,2.27,6.46Z"/>
                                <path d="M343.32,111.16c0,2.66-2.16,4.81-4.82,4.81h-1.9c-13.43,0-28.49-8.61-28.47-30.4l.06-53.46c0-2.66,2.16-4.81,4.82-4.81s4.81,2.15,4.81,4.81l-.03,24.19h17.61c2.41,0,4.43,2.03,4.43,4.43,0,2.53-2.03,4.56-4.44,4.56h-17.61l-.02,20.27c-.02,13.3,7.96,20.77,18.85,20.77h1.9c2.66,0,4.81,2.15,4.81,4.81Z"/>
                                <path d="M345.25,86.33c.02-16.59,13.46-30.15,30.06-30.15s30.13,13.55,30.11,30.15c-.02,16.59-13.59,30.02-30.18,30.02s-30.01-13.43-29.99-30.02ZM395.92,86.33c.01-11.4-9.22-20.65-20.62-20.65s-20.53,9.25-20.54,20.65c-.01,11.27,9.22,20.52,20.5,20.52s20.66-9.25,20.67-20.52Z"/>
                                <path d="M424.71,56.31h17.61c2.41,0,4.43,1.9,4.43,4.43,0,2.53-2.03,4.56-4.44,4.56h-17.61l-.05,45.86c0,2.66-2.16,4.81-4.82,4.81s-4.81-2.15-4.81-4.81l.06-53.58c.03-21.79,15.11-30.27,28.54-30.27h1.9c2.66,0,4.81,2.15,4.81,4.81,0,2.66-2.16,4.81-4.82,4.81h-1.9c-10.51,0-18.38,6.84-18.9,19.38Z"/>
                                <path d="M460.29,87.72l.06-55.74c0-2.53,2.16-4.69,4.82-4.69s4.81,2.15,4.81,4.69l-.06,55.74c-.01,12.79,6.69,18.62,17.21,18.62,2.66,0,4.68,2.15,4.68,4.81,0,2.66-2.03,4.81-4.69,4.81-16.59,0-26.84-11.02-26.82-28.25Z"/>
                            </g>
                            <path d="M548.98,63.15l-23.8,54.24c-10.98,24.98-35.5,40.36-64.44,40.36H131.34c-2.42,0-4.36-1.96-4.36-4.36,0-1.2.48-2.3,1.28-3.08.78-.8,1.86-1.28,3.08-1.28h.3c.06-.02.14-.02.22-.02h325.88c26.62,0,49.18-14.12,59.26-37.1l-21.98-48.64c-1.14-2.52-.12-5.44,2.16-6.58,2.54-1.14,5.32-.14,6.46,2.28l18.58,41.04,18.02-40.92c1.14-2.4,3.94-3.54,6.48-2.4,2.26,1.02,3.4,3.92,2.26,6.46Z"/>
                        </g>
                    </g>
                </svg>
            </div>
        </div>

        <div class="progress-section">
            <div class="section-label" id="sectionLabel">Getting Started</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <button class="back-button hidden" id="backButton">
            <svg fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Back
        </button>

        <div class="question-container" id="questionContainer"></div>

        <div class="navigation-buttons" id="navigationButtons">
            <button class="btn btn-primary" id="continueBtn">Continue</button>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const CONFIG = {
            IMPROVEMENT: {
                day7:  { MIN: 15, TARGET: 25, CAP: 85 },
                day30: { MIN: 35, TARGET: 50, CAP: 90 }
            },
            WEBHOOK_URL: 'https://alertahora.app.n8n.cloud/webhook/readytofly-waitlist'
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            startTime: new Date(),
            sessionId: 'waitlist_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
            stepTimestamps: [],
            stepDurations: [],
            backtracks: 0,
            submitted: false
        };

        // ============================================
        // DOM HELPERS
        // ============================================
        const dom = {
            container: document.getElementById('questionContainer'),
            backBtn: document.getElementById('backButton'),
            continueBtn: document.getElementById('continueBtn'),
            progressFill: document.getElementById('progressFill'),
            sectionLabel: document.getElementById('sectionLabel'),
            navigationButtons: document.getElementById('navigationButtons')
        };

        function getElement(id) {
            return document.getElementById(id);
        }

        // ============================================
        // STEP DEFINITIONS
        // ============================================
        const STEPS = [
            { 
                id: 'intro', 
                title: 'Welcome', 
                section: 'Getting Started', 
                render: renderIntroScreen 
            },
            { 
                id: 'severity', 
                title: 'Rate your fear', 
                section: 'Quick Assessment', 
                render: renderSingleChoice,
                question: 'How would you rate your current fear of flying?',
                options: ['Mild - I\'m nervous but can still fly', 'Moderate - I fly but with significant distress',
                         'Severe - I avoid flying whenever possible', 'Extreme - I haven\'t flown in years due to fear']
            },
            { 
                id: 'urgency', 
                title: 'When do you need to fly?', 
                section: 'Quick Assessment', 
                render: renderSingleChoice,
                question: 'When do you need to fly next?',
                options: ['I have a flight booked within 2 weeks', 'I have a flight booked within 1-3 months', 
                         'I want to book a flight but too anxious', 'No immediate plans but want to be ready']
            },
            { 
                id: 'impact', 
                title: 'What has it cost you?', 
                section: 'Quick Assessment', 
                render: renderSingleChoice,
                question: 'What has your fear of flying cost you?',
                options: ['Important family moments (weddings, reunions)', 'Career opportunities or advancement',
                         'Dream vacations and experiences', 'Relationships with distant loved ones', 'All of the above']
            },
            { 
                id: 'info1', 
                title: 'Did you know?', 
                section: 'Quick Assessment', 
                render: renderInfoScreen,
                content: `
                    <div class="stat-number">45,000+</div>
                    <p>Flights operate safely every single day</p>
                    <div class="info-card" style="margin-top: 2rem;">
                        <div class="stat-number">0.00001%</div>
                        <p>The actual chance of being in a plane crash</p>
                        <p style="margin-top: 15px; color: var(--muted);">That's 1 in 11 million</p>
                    </div>
                    <p style="font-size: 18px; margin-top: 30px;">
                        Turbulence has <strong style="color: var(--sky);">never</strong> caused a modern commercial plane to crash
                    </p>
                `
            },
            { 
                id: 'previousAttempts', 
                title: 'Previous attempts', 
                section: 'Your Journey', 
                render: renderMultipleChoice,
                question: 'What have you already tried to overcome your fear?',
                subtext: 'Select all that apply',
                options: ['Medication (Xanax, etc.)', 'Alcohol before flights', 'Therapy/counseling', 
                         'Self-help books', 'YouTube videos', 'Breathing exercises', 'Other apps', 'Nothing formal']
            },
            { 
                id: 'commitment', 
                title: 'Daily practice', 
                section: 'Your Journey', 
                render: renderSingleChoice,
                question: 'Could you commit 15 minutes daily for 14 days?',
                subtext: 'This is what our program requires',
                options: ['Yes, absolutely', 'Yes, I think so', 'Not sure', 'Probably not']
            },
            { 
                id: 'currentScore', 
                title: 'Your Current Flight Confidence', 
                section: 'Your Profile', 
                render: renderCurrentScore 
            },
            { 
                id: 'calculating', 
                title: 'Calculating Your Potential', 
                section: 'Your Profile', 
                render: renderCalculatingScreen 
            },
            { 
                id: 'projectedScore', 
                title: 'Where You\'ll Be', 
                section: 'Your Profile', 
                render: renderProjectedScore 
            },
            { 
                id: 'emailCapture', 
                title: 'Join the Waitlist', 
                section: 'Almost Done', 
                render: renderContactForm 
            },
            { 
                id: 'confirmation', 
                title: 'You\'re on the list!', 
                section: 'Complete', 
                render: renderConfirmation 
            }
        ];

        // ============================================
        // RENDERERS
        // ============================================
        function renderIntroScreen(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <a href="index.html" style="
                        display: inline-flex;
                        align-items: center;
                        gap: 8px;
                        color: var(--muted);
                        text-decoration: none;
                        font-size: 0.875rem;
                        margin-bottom: 20px;
                        transition: color 0.2s;
                    " onmouseover="this.style.color='var(--sky)'" onmouseout="this.style.color='var(--muted)'">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Back to Website
                    </a>
                    
                    <h2 style="font-size: 2.5rem; line-height: 1.2; margin-bottom: 1rem;">
                        Fly Anywhere,<br>Without Fear
                    </h2>
                    <p style="font-size: 1.25rem; color: var(--muted); margin-bottom: 2.5rem;">
                        Join the waitlist for the fear of flying program that actually works
                    </p>
                    
                    <div class="info-card" style="background: var(--sky-100); border-color: var(--sky);">
                        <p style="font-size: 1.5rem; font-weight: 600; color: var(--ink); margin-bottom: 1rem;">
                            Coming January 2025
                        </p>
                        <p style="color: var(--muted);">
                            Be among the first to overcome your flight anxiety with proven techniques from airline pilots and psychologists
                        </p>
                    </div>
                    
                    <div style="margin-top: 2rem;">
                        <p style="font-size: 1.125rem; margin-bottom: 1rem;">
                            <strong>Early access benefits:</strong>
                        </p>
                        <ul style="text-align: left; list-style: none; color: var(--muted);">
                            <li style="margin-bottom: 0.5rem;">✅ 50% founding member discount</li>
                            <li style="margin-bottom: 0.5rem;">✅ Exclusive pilot Q&A sessions</li>
                            <li style="margin-bottom: 0.5rem;">✅ Priority support access</li>
                            <li>✅ Free bonus: Flight Day Emergency Toolkit</li>
                        </ul>
                    </div>
                    
                    <p style="font-size: 0.875rem; color: var(--muted); margin-top: 2rem;">
                        Takes just 3 minutes • No credit card required
                    </p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Join Waitlist (3 min)';
            
            dom.continueBtn.style.padding = 'var(--space-lg) var(--space-2xl)';
            dom.continueBtn.style.fontSize = '1.25rem';
        }
        
        function renderSingleChoice(step, stepNumber) {
            let html = `<h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>`;
            html += `<h3>${step.question}</h3>`;
            if (step.subtext) html += `<h3>${step.subtext}</h3>`;
            
            html += '<div class="options-container">';
            step.options.forEach(option => {
                const isSelected = state.answers[step.id] === option;
                html += `
                    <button class="option-button ${isSelected ? 'selected' : ''}" 
                            onclick="selectSingleOption('${step.id}', '${option.replace(/'/g, "\\'")}')">
                        ${option}
                    </button>
                `;
            });
            html += '</div>';
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.add('hidden');
        }

        function renderMultipleChoice(step, stepNumber) {
            let html = `<h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>`;
            html += `<h3>${step.question}</h3>`;
            if (step.subtext) html += `<h3>${step.subtext}</h3>`;
            
            html += '<div class="options-container">';
            const selected = state.answers[step.id] || [];
            
            step.options.forEach(option => {
                const isSelected = selected.includes(option);
                html += `
                    <button class="option-button checkbox-option ${isSelected ? 'selected' : ''}" 
                            onclick="selectMultipleOption('${step.id}', '${option.replace(/'/g, "\\'")}')">
                        ${option}
                    </button>
                `;
            });
            html += '</div>';
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = !state.answers[step.id] || state.answers[step.id].length === 0;
            dom.continueBtn.textContent = 'Continue';
        }

        function renderInfoScreen(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>
                    ${step.content}
                </div>
            `;
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Continue';
        }

        function renderCurrentScore(step, stepNumber) {
            const score = calculateScore();
            state.score = score;
            
            let scoreClass = score > 60 ? 'excellent' : score > 40 ? 'high' : score > 20 ? 'medium' : 'low';
            let scoreLabel = score > 60 ? 'Ready to Fly' : score > 40 ? 'Managing Anxiety' : score > 20 ? 'Building Confidence' : 'Severe Anxiety';
            
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>
                    <div class="gauge-container">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" 
                                  class="gauge-fill ${scoreClass}" 
                                  stroke-dasharray="314" 
                                  stroke-dashoffset="${314 - (314 * score / 100)}"
                                  style="transition: stroke-dashoffset 1s ease;"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number">${score}%</div>
                            <div class="score-label">${scoreLabel}</div>
                        </div>
                    </div>
                    <p style="margin-top: 30px;">Based on your responses, flying feels nearly impossible right now.<br>
                    <strong style="color: var(--sky);">But that's about to change...</strong></p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'See Your Potential';
        }

        function renderCalculatingScreen(step, stepNumber) {
            const html = `
                <div class="calculating-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>
                    
                    <div style="
                        width: 50px;
                        height: 50px;
                        border: 3px solid #E6EEF7;
                        border-top: 3px solid #A7D8FF;
                        border-radius: 50%;
                        animation: simpleRotate 1s linear infinite;
                        margin: 20px auto;
                    " class="simple-spinner"></div>
                    
                    <div class="calculating-text">
                        Analyzing your profile<span id="dotsContainer" class="dot-animation"></span>
                    </div>
                    
                    <div class="calculating-subtext">
                        Comparing with 12,847 success stories<br>
                        to calculate your improvement potential
                    </div>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.add('hidden');
            dom.continueBtn.disabled = true;
            
            const dotsContainer = document.getElementById('dotsContainer');
            if (dotsContainer) {
                let dots = 0;
                const animateDots = setInterval(() => {
                    dots = (dots + 1) % 4;
                    dotsContainer.textContent = '.'.repeat(dots);
                }, 500);
                
                setTimeout(() => {
                    clearInterval(animateDots);
                    navigate(1);
                }, 2500);
            } else {
                setTimeout(() => navigate(1), 2500);
            }
        }

        function renderProjectedScore(step, stepNumber) {
            const currentScore = state.score || calculateScore();
            const projected7 = Math.min(CONFIG.IMPROVEMENT.day7.CAP, 
                                       Math.max(currentScore + CONFIG.IMPROVEMENT.day7.MIN, 
                                               currentScore + CONFIG.IMPROVEMENT.day7.TARGET));
            
            const currentClass = currentScore > 60 ? 'excellent' : currentScore > 40 ? 'high' : currentScore > 20 ? 'medium' : 'low';
            const scoreLabel = projected7 < 40 ? 'Building Confidence' : projected7 < 60 ? 'Managing Anxiety' : 'Ready to Fly';
            
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> Your Potential After 7 Days</h2>
                    <div class="gauge-container">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <defs>
                                <linearGradient id="improvement-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--sky);stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:var(--lavender);stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160"
                                  class="gauge-fill ${currentClass}"
                                  stroke-dasharray="${314 * currentScore / 100} ${314 * (100 - currentScore) / 100}"
                                  stroke-dashoffset="0"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160"
                                  id="improvement-path"
                                  style="fill:none;stroke:url(#improvement-gradient);stroke-width:20;stroke-linecap:round;"
                                  stroke-dasharray="0 314"
                                  stroke-dashoffset="${-(314 * currentScore / 100)}"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number" id="projected-score">${currentScore}%</div>
                            <div class="score-label" id="score-label">${scoreLabel}</div>
                        </div>
                    </div>
                    <p style="margin-top:30px;">Based on 12,847 success stories like yours</p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Get Your Survey Results Now';
            
            const improvementPath = getElement('improvement-path');
            const scoreEl = getElement('projected-score');
            const labelEl = getElement('score-label');
            
            const labelFor = (val) => (
                val < 20 ? 'Severe Anxiety' :
                val < 40 ? 'High Anxiety' :
                val < 60 ? 'Building Confidence' :
                val < 80 ? 'Managing Anxiety' : 'Ready to Fly'
            );
            
            const L = improvementPath.getTotalLength();
            const arc7 = L * (projected7 - currentScore) / 100;
            
            improvementPath.style.transition = 'none';
            improvementPath.style.strokeDasharray = `0 ${L}`;
            improvementPath.style.strokeDashoffset = `-${(L * currentScore / 100)}`;
            
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    improvementPath.style.transition = 'stroke-dasharray 1500ms ease-out';
                    improvementPath.style.strokeDasharray = `${arc7} ${L - arc7}`;
                });
            });
            
            let display = currentScore;
            const steps = 30;
            const inc = (projected7 - currentScore) / steps;
            const interval = setInterval(() => {
                display += inc;
                if (display >= projected7) { 
                    display = projected7; 
                    clearInterval(interval); 
                }
                scoreEl.textContent = `${Math.round(display)}%`;
                labelEl.textContent = labelFor(display);
            }, 50);
        }

        function renderContactForm(step, stepNumber) {
            const html = `
                <h2><span class="step-prefix">Step ${stepNumber}:</span> ${step.title}</h2>
                <h3>Get early access and 50% founding member discount</h3>
                <div style="margin-top: 30px;">
                    <input type="text" class="input-field" id="firstName" placeholder="First Name" 
                           value="${state.answers.firstName || ''}"
                           onchange="updateContactField('firstName', this.value)">
                    <input type="email" class="input-field" id="email" placeholder="Email" 
                           value="${state.answers.email || ''}"
                           onchange="updateContactField('email', this.value)">
                    <input type="tel" class="input-field" id="phone" placeholder="Phone Number (optional)" 
                           value="${state.answers.phone || ''}"
                           onchange="updateContactField('phone', this.value)">
                    <p style="font-size: 12px; color: var(--muted); margin-top: 10px;">
                        Get exclusive SMS updates about launch (optional)
                    </p>
                </div>
                <div class="waitlist-badge">
                    Limited to first 500 members
                </div>
                <p style="font-size: 14px; color: var(--muted); margin-top: 20px;">
                    No spam, ever. Unsubscribe anytime.
                </p>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.textContent = 'Secure My Spot';
            checkContactForm();
        }

        function renderConfirmation(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <div class="success-icon">✈️</div>
                    <h2>You're on the list!</h2>
                    <p style="font-size: 1.25rem; margin-bottom: 2rem;">
                        Welcome to ReadytoFly, ${state.answers.firstName || 'there'}!
                    </p>
                    
                    <div class="info-card" style="background: var(--sky-100);">
                        <p style="font-size: 1.125rem; font-weight: 600; color: var(--ink); margin-bottom: 1rem;">
                            What happens next:
                        </p>
                        <ul style="text-align: left; list-style: none;">
                            <li style="margin-bottom: 0.5rem;">📧 Check your email for confirmation</li>
                            <li style="margin-bottom: 0.5rem;">🎁 Free breathing exercise guide (in your inbox)</li>
                            <li style="margin-bottom: 0.5rem;">🚀 Early access notification in January</li>
                            <li>💰 Exclusive 50% discount code reserved</li>
                        </ul>
                    </div>
                    
                    <p style="margin-top: 2rem; color: var(--muted);">
                        Based on your assessment, you're a perfect fit for our program.<br>
                        We'll help you go from ${state.score}% to ${Math.min(85, state.score + 25)}% confidence in just 7 days.
                    </p>
                    
                    <p style="margin-top: 2rem; font-size: 0.875rem; color: var(--muted);">
                        Questions? Reply to our welcome email or contact support@readytofly.app
                    </p>
                    
                    <a href="/" style="
                        display: inline-flex;
                        align-items: center;
                        justify-content: center;
                        gap: 8px;
                        background: var(--sky-100);
                        color: var(--ink);
                        padding: 12px 32px;
                        border-radius: 12px;
                        text-decoration: none;
                        font-weight: 600;
                        font-size: 1.125rem;
                        margin-top: 2rem;
                        transition: all 0.2s;
                        border: 2px solid var(--sky);
                    " onmouseover="this.style.background='var(--sky)'; this.style.color='var(--white)'" 
                       onmouseout="this.style.background='var(--sky-100)'; this.style.color='var(--ink)'">
                        Return to Website
                    </a>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.add('hidden');
        }

        // ============================================
        // INTERACTION HANDLERS
        // ============================================
        function selectSingleOption(stepId, option) {
            state.answers[stepId] = option;
            setTimeout(() => navigate(1), 300);
        }

        function selectMultipleOption(stepId, option) {
            if (!state.answers[stepId]) state.answers[stepId] = [];
            
            const index = state.answers[stepId].indexOf(option);
            if (index > -1) {
                state.answers[stepId].splice(index, 1);
            } else {
                state.answers[stepId].push(option);
            }
            
            renderStep();
        }

        function updateContactField(field, value) {
            state.answers[field] = value;
            checkContactForm();
        }

        function checkContactForm() {
            const firstName = getElement('firstName')?.value;
            const email = getElement('email')?.value;
            const isValid = firstName && email && email.includes('@');
            dom.continueBtn.disabled = !isValid;
        }

        // ============================================
        // BUSINESS LOGIC
        // ============================================
        function calculateScore() {
            let score = 100;
            
            const severity = state.answers.severity;
            if (severity === 'Extreme - I haven\'t flown in years due to fear') score -= 60;
            else if (severity === 'Severe - I avoid flying whenever possible') score -= 45;
            else if (severity === 'Moderate - I fly but with significant distress') score -= 30;
            else if (severity === 'Mild - I\'m nervous but can still fly') score -= 15;
            
            const attempts = state.answers.previousAttempts || [];
            if (attempts.length > 5) score -= 10;
            else if (attempts.length > 3) score -= 5;
            
            const commitment = state.answers.commitment;
            if (commitment === 'Probably not') score -= 10;
            else if (commitment === 'Not sure') score -= 5;
            
            return Math.max(score, 10);
        }

        function submitData() {
            if (state.submitted) return;
            state.submitted = true;
            
            const completeData = {
                quizType: 'waitlist_short',
                sessionId: state.sessionId,
                timestamp: new Date().toISOString(),
                firstName: state.answers.firstName || '',
                email: state.answers.email || '',
                phone: state.answers.phone || '',
                severity: state.answers.severity || '',
                urgency: state.answers.urgency || '',
                impact: state.answers.impact || '',
                previousAttempts: state.answers.previousAttempts || [],
                commitment: state.answers.commitment || '',
                currentScore: state.score,
                projectedScore7: Math.min(85, state.score + 25),
                totalDurationMs: new Date() - state.startTime,
                totalDurationMin: ((new Date() - state.startTime) / 60000).toFixed(2),
                stepsCompleted: state.currentIndex + 1,
                totalSteps: STEPS.length,
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                utmSource: new URLSearchParams(window.location.search).get('utm_source') || '',
                utmMedium: new URLSearchParams(window.location.search).get('utm_medium') || '',
                utmCampaign: new URLSearchParams(window.location.search).get('utm_campaign') || '',
                isMobile: window.innerWidth < 768
            };
            
            console.log('Submitting waitlist data:', completeData);
            
            fetch(CONFIG.WEBHOOK_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(completeData)
            })
            .then(response => {
                if (response.ok) {
                    console.log('Waitlist signup successful');
                }
            })
            .catch(error => {
                console.error('Failed to submit waitlist data:', error);
                localStorage.setItem('readytofly_waitlist_pending', JSON.stringify(completeData));
            });
        }

        // ============================================
        // CORE QUIZ LOGIC
        // ============================================
        function navigate(direction) {
            const step = STEPS[state.currentIndex];
            
            if (direction === -1) {
                state.backtracks++;
            }
            
            if (direction === 1 && step.validate && !step.validate()) {
                return;
            }
            
            if (step.id === 'emailCapture' && direction === 1 && state.answers.email) {
                submitData();
            }
            
            state.currentIndex = Math.max(0, Math.min(STEPS.length - 1, state.currentIndex + direction));
            renderStep();
        }

        function renderStep() {
            const step = STEPS[state.currentIndex];
            
            state.stepTimestamps[state.currentIndex] = new Date();
            if (state.currentIndex > 0 && state.stepTimestamps[state.currentIndex - 1]) {
                const duration = new Date() - state.stepTimestamps[state.currentIndex - 1];
                state.stepDurations[state.currentIndex - 1] = duration;
            }
            
            const progress = ((state.currentIndex + 1) / STEPS.length) * 100;
            dom.progressFill.style.width = `${progress}%`;
            
            dom.sectionLabel.textContent = step.section;
            dom.backBtn.classList.toggle('hidden', state.currentIndex === 0 || step.id === 'confirmation');
            
            dom.container.innerHTML = '';
            dom.container.className = 'question-container';
            
            dom.continueBtn.style.padding = '';
            dom.continueBtn.style.fontSize = '';
            
            const stepNumber = state.currentIndex + 1;
            step.render(step, stepNumber);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        dom.continueBtn.onclick = () => navigate(1);
        dom.backBtn.onclick = () => navigate(-1);
        
        window.addEventListener('beforeunload', () => {
            if (!state.submitted && state.currentIndex > 0) {
                state.submitted = true;
                
                const data = {
                    quizType: 'waitlist_abandoned',
                    sessionId: state.sessionId,
                    stepsCompleted: state.currentIndex + 1,
                    lastStep: STEPS[state.currentIndex].id,
                    email: state.answers.email || '',
                    timeSpent: ((new Date() - state.startTime) / 60000).toFixed(2)
                };
                
                if (navigator.sendBeacon) {
                    const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
                    navigator.sendBeacon(CONFIG.WEBHOOK_URL, blob);
                }
            }
        });
        
        document.addEventListener('DOMContentLoaded', () => {
            renderStep();
        });
    </script>
</body>
</html>