<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadytoFly - Fear of Flying Assessment</title>
    
    <!-- 
    ============================================
    READYTOFLY QUIZ - 44 STEPS (REFACTORED)
    ============================================
    
    Updates:
    • Mobile-first responsive design
    • 44-step flow from specification
    • Solid coral CTAs (#FF7B73)
    • Enhanced accessibility (ARIA, keyboard nav)
    • Streamlined CSS architecture
    • All animations & scoring preserved
    -->
    
    <style>
        /* ============================================
           CSS VARIABLES
           ============================================ */
        :root {
            /* Brand colors */
            --peach: #FFD6B0;
            --coral: #FF7B73;
            --coral-hover: #FF8C82;
            --lavender: #C8B6FF;
            --sky: #A7D8FF;
            --sky-100: #E6F3FF;
            --white: #FFFFFF;
            --ink: #1F2A44;
            --muted: #6B7280;
            
            /* Surfaces */
            --surface: #FFFFFF;
            --surface-alt: #F9FBFF;
            --border: #E6EEF7;
            --shadow: 0 8px 30px rgba(31,42,68,.08);
            
            /* Status (gauges) */
            --status-low: var(--coral);
            --status-medium: var(--peach);
            --status-high: var(--lavender);
            --status-excellent: var(--sky);
            
            /* Spacing */
            --space-xs: 0.25rem;
            --space-sm: 0.5rem;
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
            --space-2xl: 3rem;
            
            /* Border radius */
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 300ms ease;
        }

        /* ============================================
           BASE STYLES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: var(--white) url('images/quiz-background.png') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh;
            color: var(--ink);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* ============================================
           LAYOUT
           ============================================ */
        .quiz-container {
            max-width: 700px;
            margin: 0 auto;
            padding: var(--space-md);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .quiz-header {
            text-align: center;
            padding: var(--space-lg) 0;
            margin-bottom: var(--space-lg);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 160px;
            margin: 0 auto;
        }

        .logo svg {
            width: 100%;
            height: auto;
        }
        
        .logo svg path {
            fill: var(--ink);
        }

        /* ============================================
           COMPONENTS - Progress Bar
           ============================================ */
        .progress-section {
            margin-bottom: var(--space-xl);
        }

        .section-label {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--space-sm);
            font-weight: 600;
        }

        .progress-bar {
            height: 6px;
            background: #E8EEF7;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .progress-fill {
            height: 100%;
            background: var(--sky);
            border-radius: var(--radius-md);
            transition: width var(--transition-base);
        }

        /* ============================================
           COMPONENTS - Question Container
           ============================================ */
        .question-container {
            flex: 1;
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            animation: fadeIn var(--transition-base);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            font-size: 1.75rem;
            margin-bottom: var(--space-lg);
            line-height: 1.3;
            color: var(--ink);
            font-weight: 700;
        }

        .step-prefix {
            font-size: 0.75rem;
            color: var(--muted);
            text-transform: uppercase;
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        h3 {
            font-size: 1rem;
            margin-bottom: var(--space-lg);
            color: var(--muted);
            font-weight: 400;
            line-height: 1.5;
        }

        /* ============================================
           COMPONENTS - Options (Chips)
           ============================================ */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }

        .option-button {
            background: var(--white);
            border: 2px solid var(--border);
            color: var(--ink);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
            font-weight: 500;
            position: relative;
        }

        /* Accessibility */
        .option-button:focus-visible {
            outline: 3px solid var(--sky);
            outline-offset: 2px;
        }

        .option-button:hover {
            background: #D9EDFF;
            border-color: var(--sky);
            transform: translateX(4px);
        }

        .option-button.selected {
            background: var(--sky-100);
            border-color: var(--sky);
            color: var(--ink);
            font-weight: 600;
        }

        /* Checkbox styling */
        .checkbox-option {
            padding-left: 3.5rem;
        }

        .checkbox-option::before {
            content: '';
            position: absolute;
            left: var(--space-lg);
            top: 50%;
            transform: translateY(-50%);
            width: 22px;
            height: 22px;
            border: 2px solid var(--border);
            border-radius: 4px;
            background: var(--white);
            transition: all var(--transition-fast);
        }

        .checkbox-option.selected::before {
            background: var(--sky);
            border-color: var(--sky);
            content: '✓';
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 14px;
        }

        /* ============================================
           COMPONENTS - Input Fields
           ============================================ */
        .input-field {
            background: var(--white);
            border: 2px solid var(--border);
            color: var(--ink);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            width: 100%;
            margin-bottom: var(--space-md);
            transition: all var(--transition-fast);
        }

        .input-field:focus {
            outline: 2px solid var(--sky);
            outline-offset: 2px;
            border-color: var(--sky);
        }

        /* ============================================
           COMPONENTS - Buttons
           ============================================ */
        .navigation-buttons {
            display: flex;
            gap: var(--space-md);
            margin-top: auto;
            padding-top: var(--space-xl);
        }

        .btn {
            padding: var(--space-md) var(--space-xl);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all var(--transition-fast);
            letter-spacing: 0.3px;
        }

        /* Primary CTA - Solid Coral */
        .btn-primary {
            background: var(--coral);
            color: var(--white);
            flex: 1;
            box-shadow: var(--shadow);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--coral-hover);
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 123, 115, 0.3);
        }

        .btn-primary:focus-visible {
            outline: 3px solid var(--sky);
            outline-offset: 2px;
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--sky);
            color: var(--ink);
            padding: var(--space-md) var(--space-lg);
        }

        .btn-secondary:hover {
            background: var(--sky-100);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--muted);
            font-size: 0.9375rem;
            cursor: pointer;
            margin-bottom: var(--space-lg);
            transition: color var(--transition-fast);
            font-weight: 500;
            background: none;
            border: none;
            padding: var(--space-sm) 0;
        }

        .back-button:hover {
            color: var(--sky);
        }

        .back-button:focus-visible {
            outline: 2px solid var(--sky);
            outline-offset: 2px;
            border-radius: 4px;
        }

        .back-button svg {
            width: 18px;
            height: 18px;
        }

        /* Back to Website Link */
        .back-to-website {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            color: var(--muted);
            text-decoration: none;
            font-size: 0.875rem;
            font-weight: 500;
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            margin-top: var(--space-lg);
        }

        .back-to-website:hover {
            color: var(--sky);
            background: var(--sky-100);
        }

        .back-to-website:focus-visible {
            outline: 2px solid var(--sky);
            outline-offset: 2px;
        }

        .back-to-website svg {
            width: 16px;
            height: 16px;
        }

        /* ============================================
           COMPONENTS - Gauge
           ============================================ */
        .gauge-container {
            position: relative;
            width: 240px;
            height: 180px;
            margin: var(--space-xl) auto;
        }

        .gauge-svg {
            width: 100%;
            height: 100%;
        }

        .gauge-background {
            fill: none;
            stroke: #E8EEF7;
            stroke-width: 18;
        }

        .gauge-fill {
            fill: none;
            stroke-width: 18;
            stroke-linecap: round;
            transition: all 0.8s ease;
        }

        .gauge-fill.low { stroke: var(--status-low); }
        .gauge-fill.medium { stroke: var(--status-medium); }
        .gauge-fill.high { stroke: var(--status-high); }
        .gauge-fill.excellent { stroke: var(--status-excellent); }

        .score-display {
            position: absolute;
            top: 68%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--ink);
        }

        .score-label {
            font-size: 0.6875rem;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* ============================================
           COMPONENTS - Info Screens
           ============================================ */
        .info-screen {
            text-align: center;
            padding: var(--space-lg) 0;
        }

        .info-screen h2 {
            margin-bottom: var(--space-xl);
        }

        .info-card {
            background: var(--surface-alt);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin: var(--space-lg) 0;
            border: 1px solid var(--border);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--sky);
            margin-bottom: var(--space-sm);
        }

        .pilot-quote {
            background: linear-gradient(135deg, rgba(167, 216, 255, 0.1), rgba(167, 216, 255, 0.2));
            border-left: 4px solid var(--sky);
            padding: var(--space-xl);
            margin: var(--space-xl) 0;
            text-align: left;
            font-style: italic;
            border-radius: var(--radius-md);
        }

        .pilot-attribution {
            text-align: right;
            margin-top: var(--space-md);
            font-size: 0.875rem;
            color: var(--muted);
            font-style: normal;
        }

        .testimonial-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            margin: var(--space-xl) 0;
            box-shadow: var(--shadow);
        }

        .stars {
            color: #FCD34D;
            font-size: 1.25rem;
            margin-bottom: var(--space-md);
        }

        /* ============================================
           COMPONENTS - Loading
           ============================================ */
        .loading-screen {
            text-align: center;
            padding: var(--space-xl) 0;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--sky);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: var(--space-xl) auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.125rem;
            margin: var(--space-lg) 0;
            color: var(--ink);
            font-weight: 600;
        }

        .loading-subtext {
            color: var(--muted);
            font-size: 0.9375rem;
        }

        /* ============================================
           COMPONENTS - Problem List
           ============================================ */
        .problem-list {
            list-style: none;
            text-align: left;
            margin: var(--space-xl) 0;
        }

        .problem-list li {
            display: flex;
            align-items: start;
            gap: var(--space-md);
            margin-bottom: var(--space-md);
            color: var(--ink);
            font-size: 0.9375rem;
        }

        .problem-icon {
            font-size: 1.25rem;
            flex-shrink: 0;
            color: var(--sky);
        }

        /* ============================================
           COMPONENTS - Pricing
           ============================================ */
        .pricing-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-lg);
            margin: var(--space-xl) 0;
        }

        .pricing-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
        }

        .pricing-card:hover {
            border-color: var(--sky);
            background: var(--sky-100);
            box-shadow: var(--shadow);
        }

        .pricing-card.selected {
            border-color: var(--sky);
            background: var(--sky-100);
            box-shadow: var(--shadow);
        }

        .pricing-badge {
            position: absolute;
            top: -10px;
            right: 20px;
            background: var(--coral);
            color: var(--white);
            padding: 0.25rem var(--space-md);
            border-radius: var(--radius-lg);
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .price-strike {
            text-decoration: line-through;
            color: var(--muted);
            font-size: 1.125rem;
        }

        .price-current {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--coral);
            margin: var(--space-sm) 0;
        }

        /* ============================================
           UTILITIES
           ============================================ */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        /* ============================================
           MOBILE RESPONSIVE
           ============================================ */
        @media (min-width: 640px) {
            .quiz-container {
                padding: var(--space-xl);
            }

            .quiz-header {
                padding: var(--space-xl) 0;
                margin-bottom: var(--space-xl);
            }

            .logo {
                width: 200px;
            }

            h2 {
                font-size: 2rem;
            }

            .step-prefix {
                font-size: 0.875rem;
            }

            h3 {
                font-size: 1.125rem;
            }

            .question-container {
                padding: var(--space-2xl);
            }

            .gauge-container {
                width: 280px;
                height: 200px;
            }

            .score-number {
                font-size: 3rem;
            }

            .stat-number {
                font-size: 3rem;
            }

            .option-button {
                font-size: 1rem;
                padding: var(--space-lg) var(--space-xl);
            }

            .checkbox-option {
                padding-left: 4rem;
            }

            .checkbox-option::before {
                width: 24px;
                height: 24px;
            }

            .btn {
                font-size: 1.125rem;
                padding: var(--space-md) var(--space-2xl);
            }

            .back-button {
                font-size: 1rem;
            }

            .progress-bar {
                height: 8px;
            }

            .section-label {
                font-size: 0.875rem;
            }

            .pricing-container {
                flex-direction: row;
            }

            .pricing-card {
                flex: 1;
            }
        }

        @media (max-width: 639px) {
            .info-screen h2 {
                font-size: 1.5rem;
            }

            .info-card {
                padding: var(--space-lg);
            }

            .pilot-quote {
                padding: var(--space-md);
            }

            .testimonial-card {
                padding: var(--space-lg);
            }
        }
    </style>
</head>
<body>
    <div class="quiz-container">
        <div class="quiz-header">
            <div class="logo">
                <svg id="Layer_2" data-name="Layer 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 587.15 157.75">
                    <g id="Layer_1-2" data-name="Layer 1">
                        <path d="M587.15,25.07c0,.07,0,.15,0,.21,0,.06,0,.12-.01.18,0,.09-.02.17-.04.26-.02.09-.05.18-.08.26-.03.09-.07.19-.11.28-.06.13-.14.26-.23.37-.06.08-.13.16-.21.23-.02.02-.03.03-.05.05-.07.06-.14.11-.21.17-.03.03-.06.05-.09.06-.07.05-.15.09-.24.13-.11.05-.21.09-.33.13-.1.03-.21.06-.33.07-.03,0-.05.01-.07,0-.1.02-.22.03-.33.03-.38,0-.78-.08-1.17-.25-2.64-1.15-7.9-2.86-13.53-1.43-.23.06-.46.12-.68.19-.19.05-.37.11-.55.17-6.43,2.17-9.35,7.64-10.52,10.75-.12.32-.3.61-.55.82-.71.58-1.74.75-2.76.38,0,0,0,0-.01,0h0c-.82-.3-1.49-.88-1.91-1.59-.3-.51-.37-1.09-.29-1.62.66-4.23.73-10.81-2.59-18.07l-.29-.62c-.4-.83-.84-1.65-1.3-2.45-.21-.36-.43-.72-.66-1.07-.25-.4-.51-.79-.78-1.18-.17-.26-.35-.5-.53-.75-.52-.72-1.08-1.43-1.66-2.12-.13-.15-.26-.31-.39-.46-.3-.34-.59-.67-.9-1-.21-.23-.43-.45-.65-.67-.06-.06-.12-.12-.18-.18-.34-.34-.68-.69-1.04-1.01-.24-.22-.48-.44-.72-.65-.03-.03-.07-.06-.1-.09-.95-.84-1.3-2.08-.94-3.08.02-.07.05-.14.08-.21.04-.07.08-.15.12-.23.03-.05.07-.11.11-.16.03-.04.06-.07.09-.11t0-.01s.03-.03.04-.04c.02-.01.03-.03.05-.05.06-.07.13-.13.2-.18.05-.05.11-.09.17-.13.02-.02.06-.03.08-.05.06-.03.13-.07.2-.1.07-.04.16-.07.25-.1.06-.03.13-.05.21-.06.84-.19,1.83.05,2.6.73,4.43,3.89,8.06,8.63,10.5,13.71,2.03,4.2,3.07,8.21,3.53,11.8,2.32-2.43,5.48-4.61,9.76-5.7,2.94-.75,5.78-.83,8.35-.56.57.05,1.13.13,1.66.22.81.13,1.58.3,2.31.48.24.06.48.12.71.19.47.13.92.26,1.34.4.21.07.42.13.61.21.75.26,1.42.52,2,.77.06.03.14.06.2.09,1.1.51,1.81,1.59,1.86,2.66Z"/>
                        <path d="M5.45,149.02h5.35c2.93,0,5.18,2.36,4.76,4.99h0c-.35,2.15-2.37,3.74-4.76,3.74h-5.35c-2.93,0-5.18-2.36-4.76-4.99h0c.35-2.15,2.37-3.74,4.76-3.74Z"/>
                        <rect x="23.42" y="149.02" width="20.52" height="8.72" rx="4.36" ry="4.36"/>
                        <rect x="52.32" y="149.02" width="27.05" height="8.72" rx="4.36" ry="4.36"/>
                        <rect x="87.57" y="149.02" width="29.23" height="8.72" rx="4.36" ry="4.36"/>
                        <g>
                            <g>
                                <path d="M28.81,56.21c1.47,0,2.7.5,3.71,1.49,1,1,1.5,2.22,1.5,3.67,0,1.45-.51,2.68-1.51,3.67-1.01,1-2.24,1.49-3.71,1.49h-9.51c-2.47,0-4.56.82-6.26,2.47-1.7,1.65-2.55,3.69-2.56,6.14l-.04,35.67c0,1.45-.51,2.68-1.51,3.67-1.01.99-2.24,1.49-3.71,1.49s-2.7-.5-3.71-1.49C.5,113.48,0,112.26,0,110.81l.04-35.67c0-2.68.51-5.16,1.52-7.46,1.01-2.29,2.38-4.3,4.12-6.02,1.74-1.72,3.79-3.06,6.15-4.01,2.36-.96,4.85-1.43,7.48-1.43h9.51Z"/>
                                <path d="M95.46,89.37l-44.59.13c1.51,9.5,8.85,16.09,19.11,17.23,5.83.63,13.3.25,20.53-6.08,2.28-.89,4.94-.63,5.95,1.65,1.14,2.15,0,4.69-2.29,5.95-5.83,5.83-14.58,8.61-25.47,7.47-16.34-1.52-27.6-14.31-27.58-29.89.02-16.47,13.33-29.77,29.93-29.77s29.12,12.67,29.1,28.63c0,2.28-1.78,4.18-3.93,4.56-.25.13-.51.13-.76.13ZM50.87,82.4h39.65c-1-10.01-9.1-17.61-19.49-17.61s-18.63,7.09-20.16,17.61Z"/>
                                <path d="M167.53,86.83q0,.13,0,.25l-.03,24.45c0,2.53-2.03,4.56-4.44,4.56-2.53,0-4.43-2.03-4.43-4.56v-5.57c-5.32,5.95-12.67,10.39-21.29,10.39-16.59,0-30.01-13.43-29.99-30.02.02-16.59,13.46-30.15,30.06-30.15s30.13,13.55,30.11,30.15v.51ZM158.04,86.33c.01-11.4-9.22-20.65-20.62-20.65s-20.53,9.25-20.54,20.65c-.01,11.27,9.22,20.52,20.5,20.52s20.66-9.25,20.67-20.52Z"/>
                                <path d="M235.18,85.57v.25c0,.13,0,.38,0,.51-.02,16.47-13.59,30.02-30.18,30.02s-30.01-13.55-29.99-30.02c.02-16.72,13.46-30.15,30.06-30.15,8.23,0,15.83,3.29,21.27,8.74l.04-32.93c0-2.66,1.91-4.69,4.44-4.69s4.43,2.03,4.43,4.69l-.06,53.58ZM225.68,86.33c.01-11.27-9.22-20.52-20.62-20.52s-20.53,9.25-20.54,20.52c-.01,11.4,9.22,20.52,20.5,20.52s20.66-9.12,20.67-20.52Z"/>
                                <path d="M298.92,63.15l-34.42,75.35c-.89,1.77-2.54,2.91-4.31,2.91-.89,0-1.52-.13-2.15-.38-2.4-1.14-3.42-4.18-2.4-6.46l11.3-22.65-21.98-48.64c-1.14-2.53-.12-5.45,2.16-6.59,2.54-1.14,5.32-.13,6.46,2.28l18.57,41.04,18.03-40.91c1.14-2.41,3.93-3.55,6.46-2.41,2.28,1.01,3.42,3.93,2.27,6.46Z"/>
                                <path d="M343.32,111.16c0,2.66-2.16,4.81-4.82,4.81h-1.9c-13.43,0-28.49-8.61-28.47-30.4l.06-53.46c0-2.66,2.16-4.81,4.82-4.81s4.81,2.15,4.81,4.81l-.03,24.19h17.61c2.41,0,4.43,2.03,4.43,4.43,0,2.53-2.03,4.56-4.44,4.56h-17.61l-.02,20.27c-.02,13.3,7.96,20.77,18.85,20.77h1.9c2.66,0,4.81,2.15,4.81,4.81Z"/>
                                <path d="M345.25,86.33c.02-16.59,13.46-30.15,30.06-30.15s30.13,13.55,30.11,30.15c-.02,16.59-13.59,30.02-30.18,30.02s-30.01-13.43-29.99-30.02ZM395.92,86.33c.01-11.4-9.22-20.65-20.62-20.65s-20.53,9.25-20.54,20.65c-.01,11.27,9.22,20.52,20.5,20.52s20.66-9.25,20.67-20.52Z"/>
                                <path d="M424.71,56.31h17.61c2.41,0,4.43,1.9,4.43,4.43,0,2.53-2.03,4.56-4.44,4.56h-17.61l-.05,45.86c0,2.66-2.16,4.81-4.82,4.81s-4.81-2.15-4.81-4.81l.06-53.58c.03-21.79,15.11-30.27,28.54-30.27h1.9c2.66,0,4.81,2.15,4.81,4.81,0,2.66-2.16,4.81-4.82,4.81h-1.9c-10.51,0-18.38,6.84-18.9,19.38Z"/>
                                <path d="M460.29,87.72l.06-55.74c0-2.53,2.16-4.69,4.82-4.69s4.81,2.15,4.81,4.69l-.06,55.74c-.01,12.79,6.69,18.62,17.21,18.62,2.66,0,4.68,2.15,4.68,4.81,0,2.66-2.03,4.81-4.69,4.81-16.59,0-26.84-11.02-26.82-28.25Z"/>
                            </g>
                            <path d="M548.98,63.15l-23.8,54.24c-10.98,24.98-35.5,40.36-64.44,40.36H131.34c-2.42,0-4.36-1.96-4.36-4.36,0-1.2.48-2.3,1.28-3.08.78-.8,1.86-1.28,3.08-1.28h.3c.06-.02.14-.02.22-.02h325.88c26.62,0,49.18-14.12,59.26-37.1l-21.98-48.64c-1.14-2.52-.12-5.44,2.16-6.58,2.54-1.14,5.32-.14,6.46,2.28l18.58,41.04,18.02-40.92c1.14-2.4,3.94-3.54,6.48-2.4,2.26,1.02,3.4,3.92,2.26,6.46Z"/>
                        </g>
                    </g>
                </svg>
            </div>
        </div>

        <div class="progress-section">
            <div class="section-label" id="sectionLabel">Getting Started</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <button class="back-button hidden" id="backButton" aria-label="Go back to previous step">
            <svg fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
            </svg>
            Back
        </button>

        <div class="question-container" id="questionContainer" role="main"></div>

        <div class="navigation-buttons" id="navigationButtons">
            <button class="btn btn-primary" id="continueBtn">Continue</button>
        </div>
    </div>

    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        const IMPROVEMENT = {
            day7:  { MIN: 15, TARGET: 25, CAP: 85 },
            day30: { MIN: 30, TARGET: 45, CAP: 90 }
        };

        // WEBHOOK CONFIGURATION
        // This URL receives data for BOTH completed AND abandoned quiz attempts
        // Data Structure:
        // - completionStatus: 'completed' | 'partial' | 'abandoned'
        // - All user answers collected so far
        // - Step tracking: which step they're on, section, title
        // - Timing: total duration, time per step
        // - Contact info: firstName, email, phone (if provided)
        // - Demographics: age, income, occupation, location (if reached)
        // - Attribution: UTM params, referrer, device info
        const WEBHOOK_URL = 'https://alertahora.app.n8n.cloud/webhook-test/readytofly-quiz';

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        const state = {
            currentIndex: 0,
            answers: {},
            score: 0,
            startTime: new Date(),
            sessionId: generateSessionId(),
            stepTimestamps: [],
            stepDurations: [],
            backtracks: 0,
            submitted: false
        };

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function generateSessionId() {
            return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getElement(id) {
            return document.getElementById(id);
        }

        function toggleClass(element, className, condition) {
            element.classList.toggle(className, condition);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ============================================
        // DOM REFERENCES
        // ============================================
        const dom = {
            container: getElement('questionContainer'),
            backBtn: getElement('backButton'),
            continueBtn: getElement('continueBtn'),
            progressFill: getElement('progressFill'),
            sectionLabel: getElement('sectionLabel'),
            navigationButtons: getElement('navigationButtons')
        };

        // ============================================
        // STEP DEFINITIONS (44 STEPS)
        // ============================================
        const STEPS = [
            // SECTION 1: ONBOARDING & FLIGHT URGENCY (1-5)
            { id: 'welcome', title: 'Welcome', section: 'Getting Started', render: renderWelcomeScreen },
            
            { id: 'urgency', title: 'When do you need to fly?', section: 'Getting Started', render: renderSingleChoice,
              question: 'When do you need to fly next?',
              options: ['I have a flight booked within 2 weeks', 'I have a flight booked within 1-3 months', 
                       'I want to book but too anxious', 'No immediate plans but want to be ready',
                       'I have important event requiring flight soon', 'I fly for work regularly']
            },
            
            { id: 'primaryGoal', title: 'Primary Flight Goal', section: 'Getting Started', render: renderSingleChoice,
              question: 'What\'s the ONE thing you most want flying confidently to give you?',
              options: ['Visit family/friends without dread', 'Take dream vacation', 'Career advancement without limits',
                       'Stop missing life events', 'Feel free and unrestricted', 'Reduce constant worry/planning around flying']
            },
            
            { id: 'severity', title: 'Current Severity', section: 'Getting Started', render: renderSingleChoice,
              question: 'Rate your current fear of flying:',
              options: ['Mild - I\'m nervous but can still fly', 'Moderate - I fly but with significant distress',
                       'Severe - I avoid flying whenever possible', 'Extreme - I haven\'t flown in years due to fear']
            },
            
            { id: 'lifeImpact', title: 'Life Impact', section: 'Getting Started', render: renderSingleChoice,
              question: 'What has your fear cost you most?',
              options: ['Important family moments (weddings, reunions, funerals)', 'Career opportunities or advancement',
                       'Dream vacations and experiences', 'Relationships with distant loved ones',
                       'Thousands in alternative travel costs', 'All of the above']
            },

            // SECTION 2: FEAR PROFILE (6-15)
            { id: 'aviationFacts', title: 'Aviation Facts', section: 'Fear Profile', render: renderInfoScreen,
              content: `
                <div class="stat-number">45,000+</div>
                <p>Flights operate safely every single day</p>
                <div class="info-card" style="margin-top: 2rem;">
                    <div class="stat-number">2,000x</div>
                    <p>Safer in a plane than in a car</p>
                </div>
                <div class="info-card">
                    <p style="font-size: 1.125rem; color: var(--sky);">
                        Turbulence has <strong>never</strong> caused a modern commercial plane to crash
                    </p>
                </div>
              `
            },

            { id: 'lastFlight', title: 'Last flight', section: 'Fear Profile', render: renderSingleChoice,
              question: 'When was the last time you flew?',
              options: ['Within the past year', '1-2 years ago', '3-5 years ago', '5-10 years ago',
                       'More than 10 years ago', 'I\'ve never flown due to fear']
            },

            { id: 'triggers', title: 'Specific Triggers', section: 'Fear Profile', render: renderMultipleChoice,
              question: 'What aspects of flying trigger your anxiety most?',
              subtext: 'Select all that apply',
              options: ['Takeoff acceleration', 'Turbulence', 'Strange noises', 'Feeling trapped/claustrophobia',
                       'Landing approach', 'Height/looking out window', 'Lack of control', 'Fear of crashing', 'Fear of panic attack']
            },

            { id: 'symptoms', title: 'Physical Symptoms', section: 'Fear Profile', render: renderMultipleChoice,
              question: 'Which physical symptoms do you experience?',
              subtext: 'Select all that apply',
              options: ['Racing heart', 'Sweating', 'Shortness of breath', 'Nausea', 'Shaking/trembling',
                       'Dizziness', 'Chest tightness', 'Panic attacks']
            },

            { id: 'pilotInfo', title: 'Message from the Cockpit', section: 'Fear Profile', render: renderInfoScreen,
              content: `
                <div class="pilot-quote">
                    <p>"In my 20 years flying, turbulence is just uncomfortable, never dangerous. Your coffee might spill, but the plane is built to handle 10x worse than anything nature throws at us."</p>
                    <div class="pilot-attribution">
                        - Captain Sarah Chen<br>15,000 flight hours
                    </div>
                </div>
                <p style="margin-top: 1.5rem; color: var(--muted);">Developed with airline pilots from:</p>
                <p style="font-size: 1.25rem; margin-top: 0.5rem;">✈️ American • United • Delta</p>
              `
            },

            { id: 'previousAttempts', title: 'Previous Attempts', section: 'Fear Profile', render: renderMultipleChoice,
              question: 'What have you already tried to overcome your fear?',
              subtext: 'Select all that apply',
              options: ['Medication (Xanax, etc.)', 'Alcohol before flights', 'Therapy/counseling', 'Self-help books',
                       'YouTube videos', 'Breathing exercises', 'Other apps', 'Hypnosis', 'Nothing formal', 'White knuckling through it']
            },

            { id: 'badExperience', title: 'Worst Flight Experience', section: 'Fear Profile', render: renderSingleChoice,
              question: 'Have you had a particularly bad flight experience?',
              options: ['Yes, severe turbulence', 'Yes, emergency/mechanical issue', 'Yes, panic attack on board',
                       'Yes, other traumatic experience', 'No, just always been afraid', 'Multiple bad experiences']
            },

            { id: 'crashBelief', title: 'Catastrophic Thinking', section: 'Fear Profile', render: renderSingleChoice,
              question: 'What percentage chance do you think your plane would crash?',
              options: ['Less than 1%', '1-5%', '5-10%', '10-25%', '25-50%', 'More than 50%']
            },

            { id: 'realityCheck', title: 'Reality Check', section: 'Fear Profile', render: renderInfoScreen,
              content: `
                <div class="info-card">
                    <div class="stat-number">0.00001%</div>
                    <p>The actual chance of being in a plane crash</p>
                    <p style="margin-top: 1rem; color: var(--muted);">That's 1 in 11 million</p>
                </div>
                <p style="font-size: 1.125rem; margin-top: 2rem;">
                    You're more likely to be struck by lightning...<br>
                    <span style="color: var(--sky); font-size: 1.5rem;">twice! ⚡⚡</span>
                </p>
              `
            },

            { id: 'avoidance', title: 'Avoidance Behaviors', section: 'Fear Profile', render: renderMultipleChoice,
              question: 'How has fear affected your travel behavior?',
              subtext: 'Select all that apply',
              options: ['I book flights then cancel', 'I only take short flights', 'I drive long distances instead',
                       'I take trains even when impractical', 'I\'ve turned down opportunities', 
                       'I make excuses to avoid travel', 'I\'ve never booked due to fear']
            },

            // SECTION 3: READINESS & ACT (16-24)
            { id: 'support', title: 'Support System', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'Do you have someone who could fly with you for support?',
              options: ['Yes, partner/spouse', 'Yes, family member', 'Yes, friend', 'No, I\'d fly alone', 'Not sure']
            },

            { id: 'financialImpact', title: 'Financial Impact', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'How much extra have you spent avoiding flights?',
              subtext: '(gas, hotels, time off)',
              options: ['Less than $500', '$500-$1,000', '$1,000-$5,000', '$5,000-$10,000', 
                       'More than $10,000', 'Hard to calculate but significant']
            },

            { id: 'testimonial1', title: 'Success Story', section: 'Readiness Assessment', render: renderInfoScreen,
              content: `
                <div class="testimonial-card">
                    <div class="stars">⭐⭐⭐⭐⭐</div>
                    <p style="font-size: 1.125rem; margin-bottom: 1.25rem;">
                        "I hadn't flown in 12 years. Missed my daughter's wedding in Hawaii. After ReadytoFly, I took 6 flights in 3 months. The techniques actually work!"
                    </p>
                    <p style="color: var(--muted);">- Maria S., Verified User</p>
                </div>
                <p style="margin-top: 2rem; font-size: 1.25rem; color: var(--sky);">
                    Join 12,847 people now flying confidently
                </p>
              `
            },

            { id: 'medication', title: 'Medication Use', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'Do you use medication or alcohol to fly?',
              options: ['Yes, prescribed medication', 'Yes, alcohol', 'Yes, both', 'No, but I\'m considering it',
                       'No, I don\'t fly at all', 'Used to, want to stop']
            },

            { id: 'careerImpact', title: 'Career Impact', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'Has your fear of flying affected your career?',
              options: ['Yes, turned down promotions', 'Yes, limited job opportunities', 'Yes, affects current role',
                       'Yes, chose career to avoid travel', 'No direct impact', 'Not applicable']
            },

            { id: 'relationshipImpact', title: 'Relationship Impact', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'Has your fear affected your relationships?',
              options: ['Yes, strain with partner/family', 'Yes, miss important events', 'Yes, feel guilty and ashamed',
                       'Yes, others don\'t understand', 'Some impact', 'No significant impact']
            },

            { id: 'sleep', title: 'Sleep Quality', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'How is your sleep before flying or thinking about flying?',
              options: ['Can\'t sleep for days before', 'Very poor night before', 'Some sleep disturbance', 'Sleep is fine']
            },

            { id: 'commitment', title: 'Commitment Level', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'How committed are you to overcoming your fear?',
              options: ['1-2: Not ready yet', '3-4: Thinking about it', '5-6: Want to change',
                       '7-8: Ready to work on it', '9-10: Whatever it takes']
            },

            { id: 'practiceWillingness', title: 'Practice Willingness', section: 'Readiness Assessment', render: renderSingleChoice,
              question: 'Could you commit 15 minutes daily for 14 days?',
              options: ['Yes, absolutely', 'Yes, I think so', 'Not sure', 'Probably not']
            },

            // SCORING CHECKPOINT (25)
            { id: 'currentScore', title: 'Your Current Flight Confidence', section: 'Your Results', render: renderCurrentScore },

            // PROJECTION (26)
            { id: 'projection7Day', title: 'Where You\'ll Be in 7 Days', section: 'Your Results', render: renderProjection7Day },

            // SECTION 4: ADDITIONAL QUESTIONS (27-36)
            { id: 'anxietyBeliefs', title: 'Beliefs About Anxiety', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'Which statement feels most true to you?',
              options: ['Anxiety is dangerous and means something is wrong', 'Anxiety is uncomfortable but not dangerous',
                       'Anxiety means I shouldn\'t fly', 'I\'m not sure what anxiety means', 'Anxiety will overwhelm me completely']
            },

            { id: 'learningStyle', title: 'Learning Style', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'How do you prefer to learn?',
              options: ['Video demonstrations', 'Audio guidance', 'Written instructions', 'Interactive exercises', 'Combination of all']
            },

            { id: 'flightGoals', title: 'Flight Goals', section: 'Understanding Your Fear', render: renderMultipleChoice,
              question: 'What flights do you want to take?',
              subtext: 'Select all that apply',
              options: ['Short domestic (under 2 hours)', 'Cross-country domestic', 'International flights',
                       'Island vacations', 'Visit specific family/friends', 'Business travel', 'Adventure travel']
            },

            { id: 'safetyBehaviors', title: 'Safety Behaviors', section: 'Understanding Your Fear', render: renderMultipleChoice,
              question: 'What do you do to feel "safer" when flying?',
              subtext: 'Select all that apply',
              options: ['Research plane crash statistics', 'Check weather obsessively', 'Sit in specific seats only',
                       'Grip armrests', 'Constantly watch wing', 'Pray/rituals', 'Study every sound', 'None - I don\'t fly']
            },

            { id: 'willingness', title: 'Willingness to Experience Discomfort', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'How willing are you to experience discomfort to do what matters?',
              options: ['Extremely willing - I\'d face high anxiety to fly', 'Very willing - I\'d tolerate significant discomfort',
                       'Moderately willing - I\'d handle some discomfort', 'Slightly willing - I\'d prefer minimal discomfort',
                       'Not willing - I must eliminate anxiety first']
            },

            { id: 'budget', title: 'Investment Willingness', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'What would you invest to fly confidently?',
              options: ['Less than $50', '$50-$100', '$100-$200', '$200-$500', 'Whatever it takes', 'Not sure']
            },

            { id: 'cognitiveFusion', title: 'Cognitive Dissonance', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'Do you relate to this statement?',
              subtext: '"I know flying is safe statistically, but I\'m convinced something bad will happen to ME"',
              options: ['Yes, exactly', 'Somewhat', 'No']
            },

            { id: 'control', title: 'Control Issues', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'Is lack of control a major trigger?',
              options: ['Yes, main issue', 'Yes, significant part', 'Somewhat', 'Not really']
            },

            { id: 'programInterest', title: 'Program Appeal', section: 'Understanding Your Fear', render: renderMultipleChoice,
              question: 'What appeals to you about our program?',
              subtext: 'Select all that apply',
              options: ['Pilot-designed education', 'Gradual exposure approach', 'No medication needed',
                       'Practice from home', 'Proven success rate', 'One-time cost (no subscription)', '30-day guarantee']
            },

            { id: 'attribution', title: 'How Did You Find Us?', section: 'Understanding Your Fear', render: renderSingleChoice,
              question: 'How did you find ReadytoFly?',
              options: ['Google search', 'Social media (Facebook/Instagram)', 'TikTok/YouTube', 'Therapist recommendation',
                       'Friend/family', 'Reddit/Forum', 'News article', 'App Store', 'Other']
            },

            // PROCESSING (37-38)
            { id: 'authority', title: 'Evidence-Based Approach', section: 'Creating Your Plan', render: renderInfoScreen,
              content: `
                <div class="info-card">
                    <p style="font-size: 1.125rem;">
                        Developed with clinical psychologists, commercial pilots, and aviation safety experts using proven CBT and exposure therapy techniques
                    </p>
                    <div style="margin-top: 1.25rem;">
                        <div class="stat-number">95%</div>
                        <p>Success Rate</p>
                    </div>
                </div>
                <p style="margin-top: 2rem; color: var(--sky); font-size: 1.5rem;">
                    12,847 successful graduates
                </p>
              `
            },

            { id: 'processing', title: 'Analyzing Profile', section: 'Creating Your Plan', render: renderLoadingScreen },

            // SECTION 5: ICP & CONTACT (39-40)
            { id: 'demographics', title: 'Quick Details', section: 'Almost There', render: renderDemographics },

            { id: 'emailCapture', title: 'Your ReadytoFly Plan', section: 'Almost There', render: renderContactForm },

            // FINAL RESULTS (41-42)
            { id: 'problemSummary', title: 'Your Flight Anxiety Profile', section: 'Your Personalized Plan', render: renderProblemSummary },

            { id: 'finalProjection', title: 'Your 30-Day Transformation', section: 'Your Personalized Plan', render: renderFinalProjection },

            // CONVERSION (43-44)
            { id: 'pricing', title: 'Special Offer', section: 'Get Started Today', render: renderPricing },

            { id: 'finalCommitment', title: 'One Last Thing', section: 'Get Started Today', render: renderFinalCommitment }
        ];

        // ============================================
        // NAVIGATION
        // ============================================
        function navigate(direction) {
            const step = STEPS[state.currentIndex];
            
            if (direction === -1) {
                state.backtracks++;
            }
            
            if (direction === 1 && step.validate && !step.validate()) {
                return;
            }
            
            // Handle final commitment
            if (step.id === 'finalCommitment' && direction === 1) {
                const answer = state.answers[step.id];
                if (answer === '✅ Yes, I\'m ready to fly confidently') {
                    submitData();
                    alert('🎉 Ready to proceed to checkout! (This would redirect to payment)');
                } else {
                    state.answers.finalDecision = 'not_ready';
                    submitData();
                    alert('We understand. Your plan has been saved. Check your email for a free breathing exercise to try first.');
                }
                return;
            }
            
            state.currentIndex = Math.max(0, Math.min(STEPS.length - 1, state.currentIndex + direction));
            renderStep();
        }

        function renderStep() {
            const step = STEPS[state.currentIndex];
            
            // Track timing
            state.stepTimestamps[state.currentIndex] = new Date();
            if (state.currentIndex > 0 && state.stepTimestamps[state.currentIndex - 1]) {
                const duration = new Date() - state.stepTimestamps[state.currentIndex - 1];
                state.stepDurations[state.currentIndex - 1] = duration;
            }
            
            // Update progress
            const progress = ((state.currentIndex + 1) / STEPS.length) * 100;
            dom.progressFill.style.width = `${progress}%`;
            
            // Update section label
            dom.sectionLabel.textContent = step.section;
            
            // Show/hide back button
            toggleClass(dom.backBtn, 'hidden', state.currentIndex === 0);
            
            // Clear container
            dom.container.innerHTML = '';
            dom.container.className = 'question-container';
            
            // Render step
            const stepNumber = state.currentIndex + 1;
            step.render(step, stepNumber);
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        function renderWelcomeScreen(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <h2 style="font-size: 2rem; line-height: 1.2; margin-bottom: 1rem;">
                        Fly Anywhere,<br>Without Fear
                    </h2>
                    <p style="font-size: 1.125rem; color: var(--muted); margin-bottom: 2rem;">
                        Join thousands who went from panic to peace at 30,000 feet using proven techniques from airline pilots and psychologists
                    </p>
                    
                    <div class="info-card" style="background: var(--sky-100); border-color: var(--sky);">
                        <div class="stat-number">12,847</div>
                        <p style="font-size: 1.125rem;">People now flying confidently</p>
                        <p style="margin-top: 1rem; color: var(--muted);">Average confidence increase: <strong style="color: var(--sky);">73%</strong> in 14 days</p>
                    </div>
                    
                    <div style="display: flex; align-items: center; justify-content: center; gap: 1.5rem; margin: 2rem 0; padding: 1.5rem; background: var(--surface-alt); border-radius: var(--radius-lg);">
                        <svg viewBox="0 0 24 24" style="width: 40px; height: 40px; color: var(--sky); flex-shrink: 0;">
                            <path fill="currentColor" d="M13,20H11V8L5.5,13.5L4.08,12.08L12,4.16L19.92,12.08L18.5,13.5L13,8V20Z"/>
                        </svg>
                        <div style="text-align: left;">
                            <p style="font-weight: 600; color: var(--ink); font-size: 1rem;">No medication needed</p>
                            <p style="font-size: 0.875rem; color: var(--muted);">Evidence-based CBT techniques only</p>
                        </div>
                    </div>
                    
                    <p style="font-size: 0.875rem; color: var(--muted); margin-bottom: 1.5rem;">
                        Takes just 10 minutes to get your personalized plan
                    </p>
                    
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <p style="font-size: 0.75rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.75rem; font-weight: 600;">
                            Developed with experts from:
                        </p>
                        <p style="font-size: 0.9375rem; color: var(--muted); line-height: 1.6;">
                            ✈️ American Airlines • United • Delta<br>
                            🧠 Stanford Psychology • Johns Hopkins
                        </p>
                    </div>
                    
                    <a href="index.html" class="back-to-website">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                        </svg>
                        Back to Website
                    </a>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Start Your Journey';
        }

        function renderSingleChoice(step, stepNumber) {
            let html = `<h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>`;
            html += `<h3>${escapeHtml(step.question)}</h3>`;
            if (step.subtext) html += `<h3 style="font-size: 0.9375rem; margin-top: -0.75rem;">${escapeHtml(step.subtext)}</h3>`;
            
            html += '<div class="options-container" role="radiogroup" aria-label="' + escapeHtml(step.question) + '">';
            step.options.forEach((option, index) => {
                const isSelected = state.answers[step.id] === option;
                const escapedOption = escapeHtml(option);
                html += `
                    <button class="option-button ${isSelected ? 'selected' : ''}" 
                            role="radio"
                            aria-checked="${isSelected}"
                            tabindex="${isSelected || index === 0 ? '0' : '-1'}"
                            data-step="${step.id}"
                            data-option="${escapedOption}">
                        ${option}
                    </button>
                `;
            });
            html += '</div>';
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.add('hidden');
            
            // Add click handlers
            dom.container.querySelectorAll('.option-button').forEach(btn => {
                btn.onclick = () => selectSingleOption(btn.dataset.step, btn.dataset.option);
                
                // Keyboard navigation
                btn.onkeydown = (e) => {
                    const buttons = Array.from(dom.container.querySelectorAll('.option-button'));
                    const currentIndex = buttons.indexOf(btn);
                    
                    if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
                        e.preventDefault();
                        const nextBtn = buttons[currentIndex + 1] || buttons[0];
                        nextBtn.focus();
                    } else if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
                        e.preventDefault();
                        const prevBtn = buttons[currentIndex - 1] || buttons[buttons.length - 1];
                        prevBtn.focus();
                    } else if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        btn.click();
                    }
                };
            });
        }

        function renderMultipleChoice(step, stepNumber) {
            let html = `<h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>`;
            html += `<h3>${escapeHtml(step.question)}</h3>`;
            if (step.subtext) html += `<h3 style="font-size: 0.9375rem; margin-top: -0.75rem;">${escapeHtml(step.subtext)}</h3>`;
            
            html += '<div class="options-container" role="group" aria-label="' + escapeHtml(step.question) + '">';
            const selected = state.answers[step.id] || [];
            
            step.options.forEach((option, index) => {
                const isSelected = selected.includes(option);
                const escapedOption = escapeHtml(option);
                html += `
                    <button class="option-button checkbox-option ${isSelected ? 'selected' : ''}" 
                            role="checkbox"
                            aria-checked="${isSelected}"
                            tabindex="0"
                            data-step="${step.id}"
                            data-option="${escapedOption}">
                        ${option}
                    </button>
                `;
            });
            html += '</div>';
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = !state.answers[step.id] || state.answers[step.id].length === 0;
            dom.continueBtn.textContent = 'Continue';
            
            // Add click handlers
            dom.container.querySelectorAll('.option-button').forEach(btn => {
                btn.onclick = () => selectMultipleOption(btn.dataset.step, btn.dataset.option);
                
                btn.onkeydown = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        btn.click();
                    }
                };
            });
        }

        function renderInfoScreen(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    ${step.content}
                </div>
            `;
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Continue';
        }

        function renderCurrentScore(step, stepNumber) {
            const score = calculateScore();
            state.score = score;
            
            let scoreClass = score > 60 ? 'excellent' : score > 40 ? 'high' : score > 20 ? 'medium' : 'low';
            let scoreLabel = score > 60 ? 'Ready to Fly' : score > 40 ? 'Managing Anxiety' : score > 20 ? 'Building Confidence' : 'Severe Anxiety';
            
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    <div class="gauge-container" role="img" aria-label="Flight confidence gauge showing ${score} percent">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" 
                                  class="gauge-fill ${scoreClass}" 
                                  stroke-dasharray="314" 
                                  stroke-dashoffset="${314 - (314 * score / 100)}"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number">${score}%</div>
                            <div class="score-label">${scoreLabel}</div>
                        </div>
                    </div>
                    <p style="margin-top: 2rem; font-size: 1rem;">
                        Based on your responses, flying feels nearly impossible right now.<br>
                        <strong style="color: var(--sky);">But that's about to change...</strong>
                    </p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'See Your Potential';
        }

        function renderProjection7Day(step, stepNumber) {
            const currentScore = state.score || calculateScore();
            const projected7 = Math.min(IMPROVEMENT.day7.CAP, 
                                       Math.max(currentScore + IMPROVEMENT.day7.MIN, 
                                               currentScore + IMPROVEMENT.day7.TARGET));
            const improvement = projected7 - currentScore;
            
            const currentClass = currentScore > 60 ? 'excellent' : currentScore > 40 ? 'high' : currentScore > 20 ? 'medium' : 'low';
            const scoreLabel = projected7 < 40 ? 'Building Confidence' : projected7 < 60 ? 'Managing Anxiety' : 'Ready to Fly';
            
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    <h3>Where you'll be in 7 days:</h3>
                    <div class="gauge-container">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <defs>
                                <linearGradient id="improvement-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--sky);stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:var(--lavender);stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160"
                                  class="gauge-fill ${currentClass}"
                                  stroke-dasharray="${314 * currentScore / 100} ${314 * (100 - currentScore) / 100}"
                                  stroke-dashoffset="0"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160"
                                  id="improvement-path"
                                  style="fill:none;stroke:url(#improvement-gradient);stroke-width:18;stroke-linecap:round;"
                                  stroke-dasharray="0 314"
                                  stroke-dashoffset="${-(314 * currentScore / 100)}"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number" id="projected-score">${currentScore}%</div>
                            <div class="score-label">${scoreLabel}</div>
                        </div>
                    </div>
                    <p style="margin-top:2rem; font-size: 1rem;">Based on 12,847 success stories like yours</p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Continue';
            
            // Animate gauge
            setTimeout(() => {
                const improvementPath = getElement('improvement-path');
                const scoreEl = getElement('projected-score');
                
                if (improvementPath) {
                    const L = improvementPath.getTotalLength();
                    const draw = L * (improvement / 100);
                    
                    improvementPath.style.transition = 'stroke-dasharray 1.5s ease-out';
                    improvementPath.style.strokeDasharray = `${draw}, ${L - draw}`;
                }
                
                if (scoreEl) {
                    let display = currentScore;
                    const steps = 30;
                    const stepInc = (projected7 - currentScore) / steps;
                    const interval = setInterval(() => {
                        display += stepInc;
                        if (display >= projected7) { 
                            display = projected7; 
                            clearInterval(interval); 
                        }
                        scoreEl.textContent = `${Math.round(display)}%`;
                    }, 50);
                }
            }, 100);
        }

        function renderLoadingScreen(step, stepNumber) {
            const html = `
                <div class="loading-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    <div class="loading-text">Analyzing your flight anxiety profile...</div>
                    <div class="spinner" role="status" aria-label="Loading"></div>
                    <div class="loading-subtext">
                        Creating your personalized flight freedom plan<br>
                        based on 12,847 success stories...
                    </div>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.continueBtn.disabled = true;
            dom.navigationButtons.classList.add('hidden');
            
            setTimeout(() => navigate(1), 3000);
        }

        function renderDemographics(step, stepNumber) {
            const html = `
                <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                <h3>Just a few quick details to personalize your plan...</h3>
                
                <div style="margin-top: 1.5rem;">
                    <label for="age" style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--ink);">Your age range:</label>
                    <select id="age" class="input-field" onchange="updateDemographic('age', this.value)">
                        <option value="">Select age range</option>
                        <option value="18-24">18-24</option>
                        <option value="25-34">25-34</option>
                        <option value="35-44">35-44</option>
                        <option value="45-54">45-54</option>
                        <option value="55-64">55-64</option>
                        <option value="65+">65+</option>
                    </select>

                    <label for="income" style="display: block; font-weight: 600; margin-bottom: 0.5rem; margin-top: 1rem; color: var(--ink);">Annual household income:</label>
                    <select id="income" class="input-field" onchange="updateDemographic('income', this.value)">
                        <option value="">Select income range</option>
                        <option value="Under $50k">Under $50k</option>
                        <option value="$50k-$75k">$50k-$75k</option>
                        <option value="$75k-$100k">$75k-$100k</option>
                        <option value="$100k-$150k">$100k-$150k</option>
                        <option value="$150k-$200k">$150k-$200k</option>
                        <option value="Over $200k">Over $200k</option>
                        <option value="Prefer not to say">Prefer not to say</option>
                    </select>

                    <label for="occupation" style="display: block; font-weight: 600; margin-bottom: 0.5rem; margin-top: 1rem; color: var(--ink);">Your occupation:</label>
                    <select id="occupation" class="input-field" onchange="updateDemographic('occupation', this.value)">
                        <option value="">Select occupation</option>
                        <option value="Executive/C-Suite">Executive/C-Suite</option>
                        <option value="Sales/Business">Sales/Business</option>
                        <option value="Healthcare">Healthcare</option>
                        <option value="Technology/Engineering">Technology/Engineering</option>
                        <option value="Education">Education</option>
                        <option value="Finance/Banking">Finance/Banking</option>
                        <option value="Entrepreneur">Entrepreneur</option>
                        <option value="Student/Retired">Student/Retired</option>
                        <option value="Other">Other</option>
                    </select>

                    <label for="location" style="display: block; font-weight: 600; margin-bottom: 0.5rem; margin-top: 1rem; color: var(--ink);">Your location:</label>
                    <select id="location" class="input-field" onchange="updateDemographic('location', this.value)">
                        <option value="">Select location</option>
                        <option value="Northeast US">Northeast US</option>
                        <option value="Southeast US">Southeast US</option>
                        <option value="Midwest US">Midwest US</option>
                        <option value="Southwest US">Southwest US</option>
                        <option value="West Coast US">West Coast US</option>
                        <option value="Outside US">Outside US</option>
                    </select>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.textContent = 'Continue';
            
            // Restore saved values
            if (state.answers.demographics) {
                const d = state.answers.demographics;
                if (d.age) getElement('age').value = d.age;
                if (d.income) getElement('income').value = d.income;
                if (d.occupation) getElement('occupation').value = d.occupation;
                if (d.location) getElement('location').value = d.location;
            }
            
            checkDemographicsForm();
        }

        function renderContactForm(step, stepNumber) {
            const html = `
                <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                <h3>Enter your details to unlock your personalized program</h3>
                <div style="margin-top: 2rem;">
                    <input type="text" class="input-field" id="firstName" placeholder="First Name" 
                           value="${state.answers.firstName || ''}"
                           onchange="updateContactField('firstName', this.value)"
                           aria-label="First Name" required>
                    <input type="email" class="input-field" id="email" placeholder="Email" 
                           value="${state.answers.email || ''}"
                           onchange="updateContactField('email', this.value)"
                           aria-label="Email Address" required>
                    <input type="tel" class="input-field" id="phone" placeholder="Phone Number" 
                           value="${state.answers.phone || ''}"
                           onchange="updateContactField('phone', this.value)"
                           aria-label="Phone Number">
                    <p style="font-size: 0.75rem; color: var(--muted); margin-top: 0.5rem;">
                        Get exclusive SMS tips and support (message rates may apply)
                    </p>
                </div>
                <p style="font-size: 0.875rem; color: var(--muted); margin-top: 1.5rem;">
                    We'll save your progress and send your personalized plan. 
                    Your information is secure and never shared.
                </p>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.textContent = 'Unlock My ReadytoFly Plan';
            checkContactForm();
        }

        function renderProblemSummary(step, stepNumber) {
            const currentScore = state.score || calculateScore();
            const scoreClass = currentScore > 60 ? 'excellent' : currentScore > 40 ? 'high' : currentScore > 20 ? 'medium' : 'low';
            
            // Generate personalized trigger list
            const triggers = state.answers.triggers || [];
            const symptoms = state.answers.symptoms || [];
            
            let triggerList = [];
            if (triggers.includes('Turbulence')) triggerList.push('<li><span class="problem-icon">✈️</span> Severe turbulence anxiety</li>');
            if (triggers.includes('Feeling trapped/claustrophobia')) triggerList.push('<li><span class="problem-icon">🔒</span> Claustrophobia/feeling trapped</li>');
            if (state.answers.crashBelief && state.answers.crashBelief !== 'Less than 1%') triggerList.push('<li><span class="problem-icon">💭</span> Catastrophic thinking patterns</li>');
            
            const lastFlight = state.answers.lastFlight || '';
            if (lastFlight.includes('10 years') || lastFlight.includes('never')) {
                triggerList.push('<li><span class="problem-icon">💔</span> Missed 5+ years of flights</li>');
            }
            
            if (symptoms.length >= 3) triggerList.push('<li><span class="problem-icon">😰</span> Physical panic symptoms</li>');
            
            if (state.answers.careerImpact && state.answers.careerImpact.includes('Yes')) {
                triggerList.push('<li><span class="problem-icon">🎯</span> Affecting career and relationships</li>');
            }
            
            if (triggerList.length === 0) {
                triggerList = [
                    '<li><span class="problem-icon">😰</span> General flight anxiety</li>',
                    '<li><span class="problem-icon">💭</span> Fear of the unknown</li>'
                ];
            }
            
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    
                    <div class="gauge-container">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" 
                                  class="gauge-fill ${scoreClass}" 
                                  stroke-dasharray="314" 
                                  stroke-dashoffset="${314 - (314 * currentScore / 100)}"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number">${currentScore}%</div>
                            <div class="score-label">Current State</div>
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 2rem;">
                        <p style="font-weight: 600; margin-bottom: 1rem; font-size: 1.125rem;">Your Triggers:</p>
                        <ul class="problem-list">
                            ${triggerList.join('')}
                        </ul>
                    </div>
                    
                    <p style="margin-top: 2rem; font-size: 1rem;">
                        Based on your profile, we're confident you can overcome these challenges with the right approach
                    </p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'See Your Transformation';
        }

        function renderFinalProjection(step, stepNumber) {
            const currentScore = state.score || calculateScore();
            const projected30 = Math.min(IMPROVEMENT.day30.CAP, currentScore + IMPROVEMENT.day30.TARGET);
            
            const medication = state.answers.medication || '';
            const severity = state.answers.severity || '';
            const commitment = state.answers.commitment || '';
            
            let successMetrics = [];
            successMetrics.push('<li><span class="problem-icon">✓</span> <strong>First calm flight:</strong> Week 2</li>');
            
            if (medication.includes('Yes')) {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>Reduced medication need:</strong> Day 10</li>');
            } else {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>Confidence milestone:</strong> Day 10</li>');
            }
            
            if (severity.includes('Extreme') || severity.includes('Severe')) {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>International flight ready:</strong> Day 30</li>');
            } else {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>Long-haul ready:</strong> Day 21</li>');
            }
            
            if (commitment.includes('9-10')) {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>Success rate:</strong> 96% with daily practice</li>');
            } else {
                successMetrics.push('<li><span class="problem-icon">✓</span> <strong>Success rate:</strong> 87% with consistent practice</li>');
            }
            
            const html = `
                <div class="info-screen">
                    <h2 id="final-title"><span class="step-prefix">Step ${stepNumber}:</span> Your Flight Anxiety Profile After 30 Days</h2>
                    
                    <div class="gauge-container">
                        <svg class="gauge-svg" viewBox="0 0 280 200">
                            <defs>
                                <linearGradient id="final-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                    <stop offset="0%" style="stop-color:var(--coral);stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:var(--lavender);stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M 40 160 A 100 100 0 0 1 240 160" class="gauge-background"/>
                            <path d="M 40 160 A 100 100 0 0 1 240 160"
                                  id="final-path"
                                  style="fill:none;stroke:url(#final-gradient);stroke-width:18;stroke-linecap:round;"
                                  stroke-dasharray="0 314"
                                  stroke-dashoffset="0"/>
                        </svg>
                        <div class="score-display">
                            <div class="score-number" id="final-score">${currentScore}%</div>
                            <div class="score-label" id="final-label">Current</div>
                        </div>
                    </div>
                    
                    <div style="text-align: left; margin-top: 2rem;">
                        <p style="font-weight: 600; margin-bottom: 1rem; font-size: 1rem;">
                            People with your profile typically achieve:
                        </p>
                        <ul class="problem-list">
                            ${successMetrics.join('')}
                        </ul>
                    </div>
                    
                    <p style="margin-top: 2rem; font-size: 1rem;">
                        Based on 12,847 similar success stories
                    </p>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Get Your Complete Plan Now';
            
            // Animate gauge
            setTimeout(() => {
                const path = getElement('final-path');
                const scoreEl = getElement('final-score');
                const labelEl = getElement('final-label');
                
                if (path && scoreEl) {
                    const L = path.getTotalLength();
                    const targetArc = L * (projected30 / 100);
                    
                    path.style.transition = 'stroke-dasharray 2s ease-out';
                    path.style.strokeDasharray = `${targetArc}, ${L - targetArc}`;
                    
                    let display = currentScore;
                    const delta = projected30 - currentScore;
                    const duration = 2000;
                    const start = performance.now();
                    
                    const animate = (now) => {
                        const t = Math.min(1, (now - start) / duration);
                        const eased = 1 - Math.pow(1 - t, 3);
                        const value = Math.round(currentScore + delta * eased);
                        scoreEl.textContent = `${value}%`;
                        
                        if (value >= 60) labelEl.textContent = 'Ready to Fly';
                        else if (value >= 40) labelEl.textContent = 'Managing Anxiety';
                        else labelEl.textContent = 'Building Confidence';
                        
                        if (t < 1) requestAnimationFrame(animate);
                    };
                    
                    requestAnimationFrame(animate);
                }
            }, 100);
        }

        function renderPricing(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    <h3>Your insurance doesn't cover flight anxiety treatment yet, but we have a solution</h3>
                    
                    <div class="pricing-container">
                        <div class="pricing-card selected">
                            <div class="pricing-badge">85% OFF</div>
                            <p class="price-strike">Regular Price: $199</p>
                            <p class="price-current">$29.99</p>
                            <p style="font-size: 0.875rem; color: var(--muted); margin-top: 0.5rem;">
                                Quiz Completion Discount
                            </p>
                            <p style="margin-top: 1rem; font-weight: 600;">
                                🎁 Bonus: Flight Day Emergency Toolkit
                            </p>
                            <p style="font-size: 0.875rem; color: var(--muted); margin-top: 0.5rem;">
                                One-time payment • Lifetime access • 30-day guarantee
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.remove('hidden');
            dom.continueBtn.disabled = false;
            dom.continueBtn.textContent = 'Claim My Discount';
        }

        function renderFinalCommitment(step, stepNumber) {
            const html = `
                <div class="info-screen">
                    <h2><span class="step-prefix">Step ${stepNumber}:</span> ${escapeHtml(step.title)}</h2>
                    <h3>Are you ready to commit to 15 minutes daily for the next 14 days to transform your relationship with flying?</h3>
                    
                    <div class="options-container" style="margin-top: 2rem;">
                        <button class="option-button" 
                                data-step="${step.id}"
                                data-option="✅ Yes, I'm ready to fly confidently"
                                style="background: var(--sky-100); border-color: var(--sky); font-size: 1.125rem; padding: 1.5rem;">
                            ✅ Yes, I'm ready to fly confidently
                        </button>
                        <button class="option-button" 
                                data-step="${step.id}"
                                data-option="❌ No, I'm not ready yet"
                                style="font-size: 1rem;">
                            ❌ No, I'm not ready yet
                        </button>
                    </div>
                    
                    <div style="text-align: center;">
                        <a href="index.html" class="back-to-website">
                            <svg fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
                            </svg>
                            Back to Website
                        </a>
                    </div>
                </div>
            `;
            
            dom.container.innerHTML = html;
            dom.navigationButtons.classList.add('hidden');
            
            dom.container.querySelectorAll('.option-button').forEach(btn => {
                btn.onclick = () => selectSingleOption(btn.dataset.step, btn.dataset.option);
            });
        }

        // ============================================
        // INTERACTION HANDLERS
        // ============================================
        function selectSingleOption(stepId, option) {
            state.answers[stepId] = option;
            setTimeout(() => navigate(1), 300);
        }

        function selectMultipleOption(stepId, option) {
            if (!state.answers[stepId]) state.answers[stepId] = [];
            
            const index = state.answers[stepId].indexOf(option);
            if (index > -1) {
                state.answers[stepId].splice(index, 1);
            } else {
                state.answers[stepId].push(option);
            }
            
            renderStep();
        }

        function updateDemographic(field, value) {
            if (!state.answers.demographics) state.answers.demographics = {};
            state.answers.demographics[field] = value;
            checkDemographicsForm();
        }

        function checkDemographicsForm() {
            const age = getElement('age')?.value;
            const income = getElement('income')?.value;
            const occupation = getElement('occupation')?.value;
            const location = getElement('location')?.value;
            
            const isValid = age && income && occupation && location;
            dom.continueBtn.disabled = !isValid;
        }

        function updateContactField(field, value) {
            state.answers[field] = value;
            checkContactForm();
        }

        function checkContactForm() {
            const firstName = getElement('firstName')?.value;
            const email = getElement('email')?.value;
            const phone = getElement('phone')?.value;
            
            const isValid = firstName && email && phone && 
                           email.includes('@') && phone.length >= 10;
            
            dom.continueBtn.disabled = !isValid;
        }

        function calculateScore() {
            let score = 100;
            
            const severity = state.answers.severity;
            if (severity === 'Extreme - I haven\'t flown in years due to fear') score -= 50;
            else if (severity === 'Severe - I avoid flying whenever possible') score -= 40;
            else if (severity === 'Moderate - I fly but with significant distress') score -= 25;
            else if (severity === 'Mild - I\'m nervous but can still fly') score -= 15;
            
            const lastFlight = state.answers.lastFlight;
            if (lastFlight === 'More than 10 years ago' || lastFlight === 'I\'ve never flown due to fear') score -= 20;
            else if (lastFlight === '5-10 years ago') score -= 15;
            else if (lastFlight === '3-5 years ago') score -= 10;
            
            const triggers = state.answers.triggers || [];
            if (triggers.length >= 5) score -= 15;
            else if (triggers.length >= 3) score -= 10;
            
            const symptoms = state.answers.symptoms || [];
            if (symptoms.length >= 5) score -= 10;
            else if (symptoms.length >= 3) score -= 5;
            
            if (state.answers.medication && state.answers.medication.includes('Yes')) score -= 5;
            
            if (state.answers.badExperience === 'Multiple bad experiences') score -= 10;
            
            return Math.max(score, 10);
        }

        function submitData() {
            if (state.submitted) return;
            state.submitted = true;
            
            if (state.currentIndex > 0 && state.stepTimestamps[state.currentIndex]) {
                const duration = new Date() - state.stepTimestamps[state.currentIndex];
                state.stepDurations[state.currentIndex] = duration;
            }
            
            const completeData = {
                sessionId: state.sessionId,
                timestamp: new Date().toISOString(),
                
                // Contact Information
                firstName: state.answers.firstName || '',
                email: state.answers.email || '',
                phone: state.answers.phone || '',
                
                // Completion Status
                completionStatus: state.currentIndex === STEPS.length - 1 ? 'completed' : 'partial',
                totalDurationMs: new Date() - state.startTime,
                totalDurationMin: ((new Date() - state.startTime) / 60000).toFixed(2),
                finalScore: state.score,
                stepsCompleted: state.currentIndex + 1,
                totalSteps: STEPS.length,
                completionRate: ((state.currentIndex + 1) / STEPS.length * 100).toFixed(1),
                
                // All Quiz Answers
                answers: state.answers,
                finalCommitment: state.answers.finalCommitment || state.answers.finalCommitment || 'not_answered',
                
                // Engagement Metrics
                avgTimePerStepMs: state.stepDurations.length ? 
                    Math.round(state.stepDurations.reduce((a,b) => a+b, 0) / state.stepDurations.length) : 0,
                longestStepMs: state.stepDurations.length ? Math.max(...state.stepDurations) : 0,
                backButtonUsed: state.backtracks,
                
                // Drop-off Tracking (for partial completions)
                dropOffStep: state.currentIndex < STEPS.length - 1 ? STEPS[state.currentIndex].id : 'completed',
                dropOffStepNumber: state.currentIndex + 1,
                dropOffStepTitle: STEPS[state.currentIndex].title,
                dropOffSection: STEPS[state.currentIndex].section,
                reachedEmailCapture: state.currentIndex >= 39,
                providedEmail: !!state.answers.email,
                providedPhone: !!state.answers.phone,
                
                // Attribution & Device Info
                userAgent: navigator.userAgent,
                referrer: document.referrer,
                utmSource: new URLSearchParams(window.location.search).get('utm_source') || '',
                utmMedium: new URLSearchParams(window.location.search).get('utm_medium') || '',
                utmCampaign: new URLSearchParams(window.location.search).get('utm_campaign') || '',
                screenWidth: window.innerWidth,
                screenHeight: window.innerHeight,
                isMobile: window.innerWidth < 768
            };
            
            console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
            console.log('📤 WEBHOOK: Submitting Quiz Data');
            console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
            console.log('Status:', completeData.completionStatus.toUpperCase());
            console.log('User:', completeData.firstName, completeData.email);
            console.log('Progress:', completeData.stepsCompleted + '/' + completeData.totalSteps, 
                        '(' + completeData.completionRate + '%)');
            console.log('Duration:', completeData.totalDurationMin, 'minutes');
            console.log('Score:', completeData.finalScore + '%');
            console.log('Webhook URL:', WEBHOOK_URL);
            console.log('Full Data:', completeData);
            console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
            
            fetch(WEBHOOK_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(completeData)
            })
            .then(response => {
                if (response.ok) {
                    console.log('✅ Webhook: Data submitted successfully');
                    return response.text();
                } else {
                    console.warn('⚠️ Webhook: Server responded with status:', response.status);
                    throw new Error('Webhook responded with status: ' + response.status);
                }
            })
            .then(responseText => {
                console.log('📥 Webhook Response:', responseText);
            })
            .catch(error => {
                console.error('❌ Webhook: Failed to submit data:', error);
                // Save to localStorage for retry
                localStorage.setItem('readytofly_pending_submission', JSON.stringify(completeData));
                console.log('💾 Data saved to localStorage for retry');
            });
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        dom.continueBtn.onclick = () => navigate(1);
        dom.backBtn.onclick = () => navigate(-1);
        
        // Track abandonment with full data
        window.addEventListener('beforeunload', () => {
            if (!state.submitted && state.currentIndex > 0) {
                const data = {
                    sessionId: state.sessionId,
                    timestamp: new Date().toISOString(),
                    completionStatus: 'abandoned',
                    
                    // Contact info (if provided)
                    firstName: state.answers.firstName || '',
                    email: state.answers.email || '',
                    phone: state.answers.phone || '',
                    
                    // Progress tracking
                    stepsCompleted: state.currentIndex + 1,
                    totalSteps: STEPS.length,
                    completionRate: ((state.currentIndex + 1) / STEPS.length * 100).toFixed(1),
                    abandonedAtStep: STEPS[state.currentIndex].id,
                    abandonedAtStepNumber: state.currentIndex + 1,
                    abandonedAtStepTitle: STEPS[state.currentIndex].title,
                    abandonedAtSection: STEPS[state.currentIndex].section,
                    
                    // All answers collected so far
                    answers: state.answers,
                    
                    // Score if calculated
                    currentScore: state.score || 0,
                    
                    // Timing data
                    totalDurationMs: new Date() - state.startTime,
                    totalDurationMin: ((new Date() - state.startTime) / 60000).toFixed(2),
                    timeSpentOnCurrentStep: state.stepTimestamps[state.currentIndex] ? 
                        ((new Date() - state.stepTimestamps[state.currentIndex]) / 1000).toFixed(1) + 's' : 'unknown',
                    
                    // Engagement metrics
                    backButtonUsed: state.backtracks,
                    reachedEmailCapture: state.currentIndex >= 39,
                    providedEmail: !!state.answers.email,
                    providedPhone: !!state.answers.phone,
                    
                    // Device & source
                    userAgent: navigator.userAgent,
                    referrer: document.referrer,
                    utmSource: new URLSearchParams(window.location.search).get('utm_source') || '',
                    utmMedium: new URLSearchParams(window.location.search).get('utm_medium') || '',
                    utmCampaign: new URLSearchParams(window.location.search).get('utm_campaign') || '',
                    screenWidth: window.innerWidth,
                    screenHeight: window.innerHeight,
                    isMobile: window.innerWidth < 768
                };
                
                console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
                console.log('📤 WEBHOOK: Quiz Abandoned');
                console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
                console.log('Abandoned at:', data.abandonedAtStepTitle, '(Step', data.abandonedAtStepNumber + ')');
                console.log('Section:', data.abandonedAtSection);
                console.log('Progress:', data.stepsCompleted + '/' + data.totalSteps, '(' + data.completionRate + '%)');
                console.log('Duration:', data.totalDurationMin, 'minutes');
                console.log('User:', data.firstName || 'Anonymous', data.email || 'No email');
                console.log('Using sendBeacon:', !!navigator.sendBeacon);
                console.log('Full Data:', data);
                console.log('━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━');
                
                if (navigator.sendBeacon) {
                    const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
                    const sent = navigator.sendBeacon(WEBHOOK_URL, blob);
                    console.log(sent ? '✅ Abandonment data sent via sendBeacon' : '❌ sendBeacon failed');
                } else {
                    // Fallback for older browsers
                    localStorage.setItem('readytofly_abandoned_submission', JSON.stringify(data));
                    console.log('💾 Abandonment data saved to localStorage (sendBeacon not supported)');
                }
            }
        });
        
        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            renderStep();
        });
    </script>
</body>
</html>